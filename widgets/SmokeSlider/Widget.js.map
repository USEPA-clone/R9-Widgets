{"version":3,"sources":["../../../widgets/SmokeSlider/Widget.js"],"names":["define","declare","lang","html","array","baseFx","WidgetManager","Move","on","query","Deferred","domGeometry","LayerInfos","LayerStructure","LayerNode","BaseWidget","TimeExtent","TimeSlider","SpeedMenu","jimuUtils","TimeProcesser","LayerProcesser","utils","a11y","clazz","baseClass","clasName","speedMenu","_showed","_timeHandles","layerInfosObj","_layerInfosDef","_timeSliderPropsDef","_miniModeTimer","_KEEP_AUTO_RESTART","_LAST_SWIPE_TIME","_LAST_SPEED_RATE","airQLayer","postCreate","inherited","arguments","layerProcesser","map","config","timeProcesser","nls","widgetId","id","_initLayerInfosObj","then","hitch","setLayerInfosObj","processTimeDisableLayer","startup","own","_onMapResize","closeBtn","_closeHanlder","isHonorWebMap","customLayersConfig","setLayersUseMapTimebyConfig","isConfigLiveMode","hasLiveDataLayer","removeClass","liveIcon","addClass","a11y_initEvents","setPosition","_isSetPosition","containerNode","style","getPositionStyle","position","place","domNode","setStyle","resize","onOpen","layerStructure","getInstance","all_layers","getLayerNodes","smoke_node","find","lyr","includes","show","airQ_label","innerHTML","title","listeners","EVENT_TOOGLE_CHANGE","_ontoggleAirQ","undefined","_isTestSizeFlag","_closeOthersTimeSlider","hasVisibleTemporalLayer","_showNoTimeLayer","showTimeSlider","initPosition","_adaptResponsive","_setPlayBtnStyleTimer","allTimeSlider","getWidgetsByName","forEach","widget","state","closeWidget","_openHanlder","openWidget","onClose","listener","remove","getNodeById","hide","noTimeContentNode","removeTimeSlider","timeSlider","pause","closeTimeSlider","_cleanPlayBtnStyleTimer","a11y_shownBy508","timeContentNode","createTimeSlider","setTimeSlider","_updateTimeSliderUI","playBtn","hasClass","_initSpeedMenu","animateProperty","node","properties","opacity","start","end","onEnd","autoPlay","emit","cancelable","bubbles","duration","play","a11y_init","_draged","_destroySpeedMenu","_onCloseTimeSliderEnd","_destroyed","getTimeSliderProps","getTsPros","tsProps","_getUpdatedFullTime","fullTimeExtent","resolve","prop","fulltime","data","props","timeExtent","sliderNode","create","sliderNodeContainer","timeConfig","timeCalendarForBuilderConfig","startTime","endTime","console","log","interval","number","units","findDefaultInterval","setThumbCount","thumbCount","setThumbMovingRate","createTimeStopsByTimeInterval","Date","numberOfStops","createTimeStopsByCount","timeStopInterval","thumbMovingRate","currentTimeExtent","getTime","setThumbIndexes","findClosestThumbIndex","timeStops","length","setTickCount","loop","loopPlay","setLoop","push","onTimeSliderChange","updateTimeExtentLabel","timeCalendarDataAutoRefresh","endLength","startTag","endTag","res","currentTime1","currentTime2","playing","updateLayerLabel","_updateBtnsUI","btns","esriTimeSlider","_rawPlayBtn","_rawPreviousBtn","_rawNextBtn","tds","_previousBtnHandler","previousBtn","_playBtnHandler","evt","slider","_slider","val","isArray","value","maximum","stopPropagation","preventDefault","_nextBtnHandler","nextBtn","window","isRTL","handle","destroy","setTimeExtent","showLabels","layerLabelsNode","label","layers","names","_getVisibleTemporalLayerNames","join","sanitizeHTML","setAttr","_getTimeFormatLabel","timeExtentLabelNode","optison","setTimeout","isRunInMobile","disableMoveable","refreshMoveable","getStyle","dragHandler","labelContainer","makeMoveable","_setPopupPosition","_moving","left","top","_setUI","btnsContainer","getContentBox","screenWidth","innerWidth","middleOfScreenWidth","w","sliderContent","isOutOfScreen","getMarginPosition","setMarginPosition","_playBtnStyleTimer","setInterval","clearTimeout","itemInfo","_onLayerInfosIsShowInMapChanged","_onLayerInfosChanged","handleNode","containerBox","getMarginBox","root","moveable","boxConstrainedMoveable","box","within","onMoveStart","onMoving","onMoveStop","mover","domBox","rightPx","parseInt","panelBox","l","t","_onHandleClick","airq_check","airq_toggle_node","isVisible","airq_checked","speedMenuNode","speedMenuSelectedHanlder","rateStr","rate","parseFloat","setSpeed","speedMenuOpenHanlder","speedMenuCloseHanlder","extend"],"mappings":"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","file":"Widget.js","sourcesContent":["///////////////////////////////////////////////////////////////////////////\n// Copyright © Esri. All Rights Reserved.\n//\n// Licensed under the Apache License Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//    http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n///////////////////////////////////////////////////////////////////////////\n\ndefine(['dojo/_base/declare',\n    'dojo/_base/lang',\n    'dojo/_base/html',\n    'dojo/_base/array',\n    'dojo/_base/fx',\n    \"jimu/WidgetManager\",\n    'dojo/dnd/move',\n    'dojo/on',\n    'dojo/query',\n    'dojo/Deferred',\n    'dojo/dom-geometry',\n    'jimu/LayerInfos/LayerInfos',\n    'jimu/LayerStructure',\n    'jimu/LayerNode',\n    'jimu/BaseWidget',\n    'esri/TimeExtent',\n    'esri/dijit/TimeSlider',\n    './SpeedMenu',\n    'jimu/utils',\n    './TimeProcesser',\n    './LayerProcesser',\n    './utils',\n    \"./a11y/Widget\"\n    //\"dojo/throttle\"\n  ],\n  function(declare, lang, html, array, baseFx, WidgetManager, Move,\n    on, query, Deferred, domGeometry,\n    LayerInfos, LayerStructure, LayerNode, BaseWidget, TimeExtent, TimeSlider,\n    SpeedMenu, jimuUtils,TimeProcesser,LayerProcesser, utils, a11y/*, throttle*/) {\n\n    var clazz = declare([BaseWidget], {\n      baseClass: 'jimu-widget-timeslider',\n      clasName: 'esri.widgets.TimeSlider',\n      speedMenu: null,\n      _showed: false,\n      _timeHandles: null,\n      layerInfosObj: null,\n\n      _layerInfosDef: null,\n      _timeSliderPropsDef: null,\n\n      _miniModeTimer: null,\n\n      _KEEP_AUTO_RESTART : null,\n      _LAST_SWIPE_TIME : null,\n      _LAST_SPEED_RATE : null,\n      airQLayer: null,\n\n\n      postCreate: function() {\n        this.inherited(arguments);\n        this._timeHandles = [];\n\n        this.layerProcesser = new LayerProcesser({map:this.map,config:this.config});\n        this.timeProcesser = new TimeProcesser({map:this.map,nls:this.nls,config:this.config,widgetId:this.id});\n\n        this._initLayerInfosObj().then(lang.hitch(this, function() {\n          this.timeProcesser.setLayerInfosObj(this.layerInfosObj);\n          this.layerProcesser.setLayerInfosObj(this.layerInfosObj);\n          this.layerProcesser.processTimeDisableLayer();\n        }));\n\n      },\n\n      startup: function() {\n        this.inherited(arguments);\n        this.own(on(this.map, 'resize', lang.hitch(this, this._onMapResize)));\n        //close btn\n        this.own(on(this.closeBtn, 'click', lang.hitch(this, this._closeHanlder)));\n        //toggle mini-mode(desktop)\n        // this.own(on(this.domNode, 'mouseover', lang.hitch(this, function () {\n        //   if (!utils.isRunInMobile()) {\n        //     this._clearMiniModeTimer();\n        //   }\n        // })));\n        // this.own(on(this.domNode, 'mouseout', lang.hitch(this, function () {\n        //   if (!utils.isRunInMobile()) {\n        //     this._setMiniModeTimer();\n        //   }\n        // })));\n        // //toggle mini-mode(mobile)\n        // this.own(on(this.domNode, 'click', lang.hitch(this, function () {\n        //   if (utils.isRunInMobile()) {\n        //     this._clearMiniModeTimer();\n        //     this._setMiniModeTimer();\n        //\n        //     var isInMiniMode = html.hasClass(this.domNode, 'mini-mode');\n        //     if (isInMiniMode) {\n        //       html.removeClass(this.domNode, 'mini-mode');\n        //       this._adaptResponsive();\n        //     }\n        //   }\n        // })));\n\n        //set time layer info by config setting\n        if (false === this.config.isHonorWebMap && this.config.customLayersConfig) {\n          utils.setLayersUseMapTimebyConfig(this.layerInfosObj, this.config);\n        }\n        if (utils.isConfigLiveMode(this.config) && this.layerProcesser.hasLiveDataLayer()) {\n          html.removeClass(this.liveIcon, 'hide');//show live icon\n        } else {\n          html.addClass(this.liveIcon, 'hide');\n        }\n\n        this.a11y_initEvents();\n      },\n\n      //overwrite for dijit in header-controller\n      setPosition: function(/*position, containerNode*/){\n        if (!this._isSetPosition) {\n          var containerNode = this.map.id;\n          var style = jimuUtils.getPositionStyle(this.position);\n          html.place(this.domNode, containerNode);\n          html.setStyle(this.domNode, style);\n\n          this._isSetPosition = true;\n        }\n      },\n\n      resize: function () {\n        //throttle(lang.hitch(this, this._onMapResize), 200);\n        this._onMapResize();\n      },\n\n      onOpen: function() {\n        // DW turn on layer\n        var layerStructure = LayerStructure.getInstance();\n        const all_layers = layerStructure.getLayerNodes();\n        // NDGD_SmokeForecast_v1_1852\n        const smoke_node = all_layers.find((lyr) => {return lyr.id.includes('NDGD_SmokeForecast');});\n        smoke_node.show();\n        // AirNowLatestContoursPM25_2250\n        this.airQLayer = all_layers.find((lyr) => {return lyr.id.includes('AirNowLatestContours');});\n        this.airQ_label.innerHTML = this.airQLayer.title;\n\n        this.listeners = [this.airQLayer.on(LayerNode.EVENT_TOOGLE_CHANGE, () => {\n          this._ontoggleAirQ(undefined);\n        })];\n\n        if (this._isTestSizeFlag) {\n          return;\n        }\n\n        this._closeOthersTimeSlider();\n\n        this._initLayerInfosObj().then(lang.hitch(this, function () {\n          if (!this.layerProcesser.hasVisibleTemporalLayer()) {\n            this._showNoTimeLayer();\n          } else {\n            if (!this._showed) {\n              this.showTimeSlider();\n            }\n          }\n\n          //initPosition\n          utils.initPosition(this.map, this.domNode, this.position);\n          this._adaptResponsive();\n\n          this._setPlayBtnStyleTimer();\n          this._ontoggleAirQ(undefined);\n          // this.a11y_open();\n        }));\n      },\n      _closeOthersTimeSlider: function () {\n        var allTimeSlider = WidgetManager.getInstance().getWidgetsByName(\"TimeSlider\");\n        array.forEach(allTimeSlider, lang.hitch(this, function (widget) {\n          if (widget.state === \"opened\" && this.id !== widget.id) {\n            WidgetManager.getInstance().closeWidget(widget);//close others TimeSlider\n          }\n        }));\n      },\n      _openHanlder: function(){\n        WidgetManager.getInstance().openWidget(this);\n      },\n\n      onClose: function() {\n      this.listeners.forEach(function (listener) {\n        listener.remove();\n      });\n        // DW turn off layer\n        var layerStructure = LayerStructure.getInstance();\n        layerStructure.getNodeById(\"NDGD_SmokeForecast_v1_1852\").hide();\n        //layerStructure.getNodeById(\"AirNowLatestContoursPM25_2250\").hide();\n\n        this._initLayerInfosObj().then(lang.hitch(this, function() {\n          if (!this.layerProcesser.hasVisibleTemporalLayer()) {\n            html.setStyle(this.noTimeContentNode, 'display', 'none');\n            this._showed = false;\n\n            if (this.map.removeTimeSlider) {\n              this.map.removeTimeSlider();\n            }\n          } else {\n            if (this._showed) {\n              this.timeSlider.pause();\n              this.closeTimeSlider();\n            }\n          }\n\n          //this.timeProcesser.clearAutoRefreshTimer();//autoRefresh\n          this._cleanPlayBtnStyleTimer();\n        }));\n        this.airQLayer.hide();\n      },\n      //on close btn click\n      _closeHanlder: function(){\n        this.a11y_shownBy508 = false;\n        WidgetManager.getInstance().closeWidget(this);\n      },\n      _showNoTimeLayer: function () {\n        html.setStyle(this.noTimeContentNode, 'display', 'block');\n        html.setStyle(this.timeContentNode, 'display', 'none');\n        this._showed = true;\n      },\n\n      showTimeSlider: function() {\n        html.setStyle(this.noTimeContentNode, 'display', 'none');\n\n        this.createTimeSlider().then(lang.hitch(this, function() {\n          if(\"undefined\" === typeof this.timeSlider){\n            this._showNoTimeLayer();\n            return;\n          }\n\n          this.timeProcesser.setTimeSlider(this.timeSlider);\n          this.layerProcesser.setTimeSlider(this.timeSlider);\n          this._updateTimeSliderUI();\n\n          //restore playBtn state\n          if (this.playBtn && html.hasClass(this.playBtn, \"pause\")) {\n            html.removeClass(this.playBtn, \"pause\");\n          }\n          //styles\n          html.setStyle(this.domNode, 'display', 'block');\n          html.setStyle(this.timeContentNode, 'display', 'block');\n          html.addClass(this.domNode, 'show-time-slider');\n          this._initSpeedMenu();\n\n          baseFx.animateProperty({\n            node: this.timeContentNode,\n            properties: {\n              opacity: {\n                start: 0,\n                end: 1\n              }\n            },\n            onEnd: lang.hitch(this, function() {\n              this._showed = true;\n              //auto play when open\n              if (false !== this.config.autoPlay &&\n                false === html.hasClass(this.playBtn, \"pause\")) {\n                on.emit(this.playBtn, 'click', { cancelable: false, bubbles: true });\n              }\n              this._adaptResponsive();\n            }),\n            duration: 500\n          }).play();\n\n          this.a11y_init();\n        }));\n      },\n\n      closeTimeSlider: function() {\n        this._draged = false;\n        this._isSetPosition = false;\n        this._showed = false;\n        this._timeSliderPropsDef = null;\n\n        html.setStyle(this.domNode, 'display', 'none');\n\n        this.removeTimeSlider();\n        this._destroySpeedMenu();\n\n        baseFx.animateProperty({\n          node: this.timeContentNode,\n          properties: {\n            opacity: {\n              start: 1,\n              end: 0\n            }\n          },\n          onEnd: lang.hitch(this, this._onCloseTimeSliderEnd),\n          duration: 500\n        }).play();\n      },\n\n      _onCloseTimeSliderEnd: function() {\n        if (this._destroyed) {\n          return;\n        }\n        html.removeClass(this.domNode, 'show-time-slider');\n        if (this.state === 'closed') {\n          html.removeClass(this.domNode, 'mobile-time-slider');\n          html.removeClass(this.timeContentNode, 'mobile');\n        }\n      },\n\n      getTimeSliderProps: function() {\n        if (!this._timeSliderPropsDef) {\n\n          this._timeSliderPropsDef = new Deferred();\n          this.own(this._timeSliderPropsDef);\n          //var itemInfo = map && map.itemInfo;\n          this.timeProcesser.getTsPros().then(lang.hitch(this, function (tsProps) {\n            /*if (null !== tsProps &&\n              (this.timeProcesser.needUpdateFullTime() || true === tsProps._needToFindDefaultInterval)) {\n              this.timeProcesser._getUpdatedFullTime().then(lang.hitch(this, function (fullTimeExtent) {\n                var start = fullTimeExtent.startTime.getTime();\n                var end = fullTimeExtent.endTime.getTime();\n\n                //TODO reset timeExtent:consider liveData\n                if (tsProps.startTime > end || tsProps.endTime < start) {\n                  tsProps.startTime = start;\n                  tsProps.endTime = end;\n                } else {\n                  // if (tsProps.startTime < start) {\n                  //   tsProps.startTime = start;\n                  // }\n                  // if (tsProps.endTime > end) {\n                  //   tsProps.endTime = end;\n                  // }\n                }\n\n                if (true === tsProps._needToFindDefaultInterval) {\n                  tsProps.timeStopInterval = this.timeProcesser.findDefaultInterval(fullTimeExtent);\n                }\n\n                this._timeSliderPropsDef.resolve(tsProps);\n              }));\n            } else {\n              this._timeSliderPropsDef.resolve(tsProps);\n            }*/\n            this.timeProcesser._getUpdatedFullTime().then(lang.hitch(this, function (fullTimeExtent) {\n              this._timeSliderPropsDef.resolve({\n                prop: tsProps,\n                fulltime: fullTimeExtent\n              });\n            }));\n          }));\n        }\n\n        return this._timeSliderPropsDef;\n      },\n\n      createTimeSlider: function () {\n        return this.getTimeSliderProps().then(lang.hitch(this, function (data) {\n          var props = data.prop,\n            fullTimeExtent = data.fulltime;\n          var timeExtent = null;\n          // if (!props) {\n          //   return;\n          // }\n          if (this.timeSlider) {\n            return this.timeSlider;\n          }\n          //this domNode will be deleted when TimeSlider destroy\n          this.sliderNode = html.create('div', {}, this.sliderNodeContainer);\n\n          this.timeSlider = new TimeSlider({}, this.sliderNode);\n          this.map.setTimeSlider(this.timeSlider);\n          /******************  time-extent-change demo ********************\n          this.own(on(this.map.timeSlider, 'time-extent-change', lang.hitch(this, function (res) {\n            //1.time info\n            var startTime = res.startTime,\n              endTime = res.endTime;\n            //2.layer info(LayerInfos.getInstance() ==> this.layerInfosObj)\n            array.forEach(this.layerInfosObj.getLayerInfoArray(), function (info) {\n              if (info.layerObject.setUseMapTime) {\n                var isUseTime = info.layerObject.useMapTime;\n              }\n            });\n          })));\n          **************************************/\n\n          if (false === this.config.isHonorWebMap) {\n            //custom layers & custom time\n            var timeConfig = utils.timeCalendarForBuilderConfig(this.config);\n\n            if (null === timeConfig || (!timeConfig.startTime && !timeConfig.endTime)) {\n              console.log(\"timeSlider: time param error\");\n            }\n\n            timeExtent = new TimeExtent(timeConfig.startTime, timeConfig.endTime);\n            //timeConfig.interval = null;//hack\n            // if(null === timeConfig.interval ||\n            // (!timeConfig.interval.number && !timeConfig.interval.units)){\n            //   this.timeSlider.createTimeStopsByCount(timeExtent, (timeConfig.numberOfStops + 1));//TODO\n            // }\n            if (!timeConfig.interval.number && !timeConfig.interval.units) {\n              timeConfig.interval = this.timeProcesser.findDefaultInterval(timeExtent);\n            }\n            this.timeSlider.setThumbCount(timeConfig.thumbCount);\n            //this.timeSlider.setThumbIndexes([0, 1]);//default start\n            this.timeSlider.setThumbMovingRate(2000);\n\n            if (timeConfig.interval.number === \"0\" || timeConfig.interval.number === 0) {\n              timeConfig.interval.number = 1;\n            }\n\n            this.timeSlider.createTimeStopsByTimeInterval(timeExtent, timeConfig.interval.number,\n              timeConfig.interval.units);\n\n            if (this._LAST_SWIPE_TIME) {\n              this._LAST_SWIPE_TIME = null;\n            }\n          } else {//true === this.config.isHonorWebMap\n\n            //create by webmap config\n            if (props) {\n              //var timeExtent = null;\n              if (props.startTime && props.endTime) {\n                timeExtent = new TimeExtent(new Date(props.startTime), new Date(props.endTime));\n              } else if (props.startTime) {\n                timeExtent = new TimeExtent(new Date(props.startTime), fullTimeExtent.endTime);\n              } else if (props.endTime) {\n                timeExtent = new TimeExtent(fullTimeExtent.startTime, new Date(props.endTime));\n              } else {\n                timeExtent = new TimeExtent(fullTimeExtent.startTime, fullTimeExtent.endTime);\n              }\n              // bug in saved web map?\n              if (timeExtent.startTime > timeExtent.endTime) {\n                timeExtent = new TimeExtent(fullTimeExtent.startTime, fullTimeExtent.endTime);\n              }\n              this.timeSlider.setThumbCount(props.thumbCount);\n              if (props.numberOfStops) {\n                this.timeSlider.createTimeStopsByCount(timeExtent, (props.numberOfStops + 1));\n              } else {\n                this.timeSlider.createTimeStopsByTimeInterval(timeExtent,\n                  props.timeStopInterval.interval, props.timeStopInterval.units);\n              }\n              this.timeSlider.setThumbMovingRate(props.thumbMovingRate);\n\n              //palyback\n              if (props.currentTimeExtent) {\n                if (!props.currentTimeExtent[0]) {\n                  props.currentTimeExtent[0] = timeExtent.startTime.getTime();\n                }\n                if (!props.currentTimeExtent[1]) {\n                  props.currentTimeExtent[1] = timeExtent.endTime.getTime();\n                }\n                //var timeStops = this.timeSlider.timeStops;\n                if (props.thumbCount === 1) {\n                  this.timeSlider.setThumbIndexes(\n                    [this.timeProcesser.findClosestThumbIndex(this.timeSlider, props.currentTimeExtent[1])]);\n                } else {\n                  var start = this.timeProcesser.findClosestThumbIndex(this.timeSlider, props.currentTimeExtent[0]);\n                  if (props.currentTimeExtent[0] === props.currentTimeExtent[1]) {\n                    this.timeSlider.setThumbIndexes([start, start]);\n                  } else {\n                    var end = this.timeProcesser.findClosestThumbIndex(this.timeSlider, props.currentTimeExtent[1]);\n                    if (start < end) {\n                      this.timeSlider.setThumbIndexes([start, end]);\n                    } else {\n                      this.timeSlider.setThumbIndexes([start, start + 1]);\n                    }\n                  }\n                }\n              } else {\n                if (props.thumbCount === 2) {\n                  this.timeSlider.setThumbIndexes([0, 1]);//default start\n                }\n              }\n\n              //layers\n              //this.layerProcesser.processerDisableLayers(props);\n            } else {\n              // no-props: default settings\n              props = {};\n              props.thumbCount = 2;\n              this.timeSlider.setThumbCount(props.thumbCount);\n              this.timeSlider.setThumbIndexes([0, 1]);\n\n              this.timeSlider.setThumbMovingRate(2000);\n              //this.findDefaultInterval();\n              props.timeStopInterval = this.timeProcesser.findDefaultInterval(fullTimeExtent);\n              this.timeSlider.createTimeStopsByTimeInterval(fullTimeExtent,\n                props.timeStopInterval.interval, props.timeStopInterval.units);\n            }\n          }\n\n          if (this.timeSlider.timeStops.length > 25) {\n            this.timeSlider.setTickCount(0);\n          }\n\n          var loop = true;\n          if (false === this.config.loopPlay) {\n            loop = false;\n          }\n          this.timeSlider.setLoop(loop);\n          this.timeSlider.startup();\n\n          //this.timeProcesser.restoreAutoRefreshTimer(this.timeSlider);//set autoRefresh Stops\n\n          if (this._KEEP_AUTO_RESTART) {\n            this.timeSlider.play();\n            this._KEEP_AUTO_RESTART = null;\n          }\n\n          this._timeHandles.push(on(\n            this.timeSlider,\n            'time-extent-change',\n            lang.hitch(this, this.onTimeSliderChange)\n          ));\n\n          return this.timeSlider;\n        }));\n      },\n      onTimeSliderChange: function (timeExtent) {\n        //console.log(\"playing==>\"+this.timeSlider.playing);\n        this.updateTimeExtentLabel(timeExtent);\n\n        if (utils.isConfigLiveMode(this.config)) {\n          this.timeCalendarDataAutoRefresh(timeExtent);//need to rebuild timeExtent\n        }\n      },\n      timeCalendarDataAutoRefresh: function (timeExtent) {\n        if (timeExtent && timeExtent.startTime) {\n          var endLength = this.timeSlider.timeStops.length >= 1 ? this.timeSlider.timeStops.length - 1 : 0;\n          var startTag = this.timeSlider.timeStops[0].getTime();\n          var endTag = this.timeSlider.timeStops[endLength].getTime();\n          var res = false;\n          var currentTime1 = timeExtent.startTime.getTime();\n          var currentTime2 = timeExtent.endTime.getTime();\n\n          if (!this._LAST_SWIPE_TIME) {\n            this._LAST_SWIPE_TIME = {};\n            res = false;\n          } else {\n            if (this.timeSlider.playing) {//when playing\n              if (1 === this.timeSlider.thumbCount) {\n                if (currentTime2 === startTag && this._LAST_SWIPE_TIME.endTime === endTag) {\n                  res = true;\n                }\n              } else {\n                if (currentTime1 === startTag && this._LAST_SWIPE_TIME.endTime === endTag) {\n                  res = true;\n                }\n              }\n            }\n          }\n\n          this._LAST_SWIPE_TIME.startTime = currentTime1;\n          this._LAST_SWIPE_TIME.endTime = currentTime2;\n\n          if (res) {\n            console.log(\"auto refresh\");\n            this._KEEP_AUTO_RESTART = true;\n            this._closeHanlder();\n            this._openHanlder();\n          }\n        }\n      },\n\n      _updateTimeSliderUI: function () {\n        this.updateLayerLabel();\n        this.updateTimeExtentLabel();\n        this._updateBtnsUI();\n      },\n      _updateBtnsUI: function(){\n        //find and hide raw btns\n        var btns = query(\".esriTimeSlider > table > tbody > tr > td > span > span\", this.esriTimeSlider);\n        if (btns && 3 === btns.length) {\n          this._rawPlayBtn = btns[0];\n          this._rawPreviousBtn = btns[1];\n          this._rawNextBtn = btns[2];\n        }\n        var tds = query(\".esriTimeSlider > table > tbody > tr > td\", this.esriTimeSlider);\n        if (tds && 4 === tds.length) {\n          html.addClass(tds[0], \"hide\");//_rawPlayBtn\n          html.addClass(tds[2], \"hide\");//_rawPreviousBtn\n          html.addClass(tds[3], \"hide\");//_rawNextBtn\n        }\n\n        //trigger events\n        if(!this._previousBtnHandler){\n          this._previousBtnHandler = this.own(on(this.previousBtn, 'click', lang.hitch(this, function () {\n            on.emit(this._rawPreviousBtn, 'click', { cancelable: false, bubbles: true });\n          })));\n        }\n        if(!this._playBtnHandler){\n          this._playBtnHandler = this.own(on(this.playBtn, 'click', lang.hitch(this, function (evt) {\n            on.emit(this._rawPlayBtn, 'click', {cancelable: false, bubbles: true });\n            //toggle pause class\n            if(html.hasClass(this.playBtn, \"pause\")){\n              html.removeClass(this.playBtn, \"pause\");\n\n              //this.timeProcesser.clearAutoRefreshTimer();//autoRefresh\n            } else {\n              html.addClass(this.playBtn, \"pause\");\n              // if(utils.isRunInMobile()){\n              //   html.addClass(this.domNode, 'mini-mode');\n              //   this._adaptResponsive();\n              // }\n\n              //this.timeProcesser.setAutoRefreshTimer(this);//auto refresh\n            }\n\n            //hack loop=false, click play btn can't play again\n            var slider = this.timeSlider._slider, val;\n            if (lang.isArray(slider.value)) {\n              val = slider.value[1];\n            } else {\n              val = slider.value;\n            }\n            if (this.timeSlider.loop !== true && val === slider.maximum) {\n              this.timeSlider.play();\n              if (this.timeSlider.thumbCount > 1) {\n                this.timeSlider.setThumbIndexes([0, 1]);\n              } else {\n                this.timeSlider.setThumbIndexes(0);\n              }\n            }\n\n            evt.stopPropagation();\n            evt.preventDefault();\n          })));\n        }\n        if(!this._nextBtnHandler){\n          this._nextBtnHandler = this.own(on(this.nextBtn, 'click', lang.hitch(this, function () {\n            on.emit(this._rawNextBtn, 'click', { cancelable: false, bubbles: true });\n          })));\n        }\n        //replace play btns, under RTL\n        if (window.isRTL) {\n          html.place(this.previousBtn, this.playBtn, \"after\");\n          html.place(this.nextBtn, this.playBtn, \"before\");\n        }\n      },\n\n      removeTimeSlider: function() {\n        array.forEach(this._timeHandles, function(handle) {\n          if (handle && handle.remove) {\n            handle.remove();\n          }\n        });\n        if (this.timeSlider && !this.timeSlider._destroyed) {\n          this.timeSlider.destroy();\n          this.timeSlider = null;\n        }\n\n        if (this.map) {\n          this.map.setTimeExtent();\n        }\n      },\n\n      updateLayerLabel: function() {\n        if (this.config.showLabels) {\n          html.setStyle(this.layerLabelsNode, 'display', 'block');\n          var label = this.nls.layers;\n          var names = this.layerProcesser._getVisibleTemporalLayerNames();\n          label = label + names.join(',');\n          this.layerLabelsNode.innerHTML = jimuUtils.sanitizeHTML(label);\n          html.setAttr(this.layerLabelsNode, 'title', label);\n        } else {\n          html.setStyle(this.layerLabelsNode, 'display', 'none');\n        }\n      },\n\n      updateTimeExtentLabel: function (timeExtent) {\n        //TODO Humanize duration text\n        var label = this.timeProcesser._getTimeFormatLabel(timeExtent);\n        //console.log(\"===>\"+label);\n        this.timeExtentLabelNode.innerHTML = jimuUtils.sanitizeHTML(label);\n        html.setAttr(this.timeExtentLabelNode, 'title', label);\n      },\n\n      _adaptResponsive: function (optison) {\n        if (!this._showed) {\n          return;\n        }\n\n        setTimeout(lang.hitch(this, function () {\n          if (utils.isRunInMobile()) {\n            this.disableMoveable();\n            html.addClass(this.timeContentNode, 'mobile');\n            html.addClass(this.domNode, 'mobile');\n          } else {\n            //DO NOT makeMoveable, when _clearMiniModeTimer\n            if (!(optison && \"undefined\" !== typeof optison.refreshMoveable && false === optison.refreshMoveable)) {\n              if (\"none\" !== html.getStyle(this.noTimeContentNode, \"display\")) {\n                this.dragHandler = this.noTimeContentNode;\n              } else {\n                this.dragHandler = this.labelContainer;\n              }\n\n              this.makeMoveable(this.dragHandler);\n            }\n\n            html.removeClass(this.timeContentNode, 'mobile');\n            html.removeClass(this.domNode, 'mobile');\n          }\n          this._setPopupPosition(utils.isRunInMobile());\n        }), 10);\n      },\n\n      _setPopupPosition: function (isRunInMobile) {\n        if(!isRunInMobile){\n          //height\n          if (this.config.showLabels){\n            html.setStyle(this.domNode, 'height','92px');\n          } else {\n            html.setStyle(this.domNode, 'height','72px');\n          }\n\n          //do not initPosition it, if moveed by drag\n          if (!this._draged) {\n            utils.initPosition(this.map, this.domNode, this.position);\n          }\n\n          if (!this._moving && this.position &&\n            this.position.left && this.position.top) {\n            html.setStyle(this.domNode, 'top', this.position.top + 'px');\n            html.setStyle(this.domNode, 'left', this.position.left + 'px');\n          }\n        } else {\n          //height\n          if (this.config.showLabels){\n            html.setStyle(this.domNode, 'height','128px');\n          } else {\n            html.setStyle(this.domNode, 'height','108px');\n          }\n        }\n\n        this._setUI(isRunInMobile);\n      },\n      _setUI:function(isRunInMobile){\n        var btnsContainer = html.getContentBox(this.btnsContainer);\n\n        if(isRunInMobile){\n          var screenWidth = window.innerWidth;\n          var middleOfScreenWidth = screenWidth / 2;\n          var left = middleOfScreenWidth - btnsContainer.w / 2;\n\n          if(window.isRTL){\n            html.setStyle(this.btnsContainer, 'margin-right', left + 'px');\n          } else {\n            html.setStyle(this.btnsContainer, 'margin-left', left + 'px');\n          }\n\n          if (this.config.showLabels && !html.hasClass(this.domNode, 'mini-mode')) {\n            html.setStyle(this.sliderContent, 'bottom', '-12px');\n            html.setStyle(this.sliderContent, 'bottom', '-120px');\n          } else if (this.config.showLabels && html.hasClass(this.domNode, 'mini-mode')) {\n            html.setStyle(this.sliderContent, 'bottom', '20px');\n          }\n\n        } else {\n          html.setStyle(this.btnsContainer, 'margin-left', 'auto');\n          html.setStyle(this.btnsContainer, 'margin-right', 'auto');\n\n          if (this.config.showLabels && !html.hasClass(this.domNode, 'mini-mode')) {\n            //showLabels && no 'mini-mode'\n            html.setStyle(this.sliderContent, 'bottom', '-20px');\n          } else if (this.config.showLabels && html.hasClass(this.domNode, 'mini-mode')) {\n            //showLabels && 'mini-mode'\n            html.setStyle(this.sliderContent, 'bottom', '20px');\n          } else {\n            //no showLabels\n            html.setStyle(this.sliderContent, 'bottom', '0px');\n          }\n        }\n      },\n\n      _onMapResize: function() {\n        if (this.state === 'closed') {\n          return;\n        }\n\n        //initPosition when widget OutofScreen\n        if(!utils.isRunInMobile()){\n          if (!utils.isOutOfScreen(this.map, this.position)) {\n            utils.getMarginPosition(this.map, this.domNode, this.position);\n          } else if (utils.isOutOfScreen(this.map, this.position)) {\n            //utils.initPosition(this.map, this.domNode, this.position);\n            utils.setMarginPosition(this.map, this.domNode, this.position);\n          }\n        }\n\n        this._adaptResponsive();\n      },\n\n      destroy: function() {\n        if (this.map) {\n          this.map.setTimeExtent(null);\n        }\n        this.inherited(arguments);\n      },\n\n      //play btn style\n      _setPlayBtnStyleTimer: function () {\n        this._playBtnStyleTimer = setInterval(lang.hitch(this, function () {\n          if (this.timeSlider && this.timeSlider.playing) {\n            html.addClass(this.playBtn, \"pause\");\n            html.setAttr(this.playBtn, \"aria-label\", this.nls.pause);\n          } else {\n            html.removeClass(this.playBtn, \"pause\");\n            html.setAttr(this.playBtn, \"aria-label\", this.nls.play);\n          }\n        }), 200);\n      },\n      _cleanPlayBtnStyleTimer: function () {\n        if (this._playBtnStyleTimer) {\n          clearTimeout(this._playBtnStyleTimer);\n        }\n      },\n\n      //LayerInfosObj\n      _initLayerInfosObj: function () {\n        if (!this._layerInfosDef) {\n          this._layerInfosDef = new Deferred();\n          this.own(this._layerInfosDef);\n\n          LayerInfos.getInstance(this.map, this.map.itemInfo).then(lang.hitch(this, function (layerInfosObj) {\n            // if (this.domNode) {\n            //   }\n            this.layerInfosObj = layerInfosObj;\n            // should check whether is timeInfo layer.\n            this.own(on(\n              layerInfosObj,\n              'layerInfosIsShowInMapChanged',\n              lang.hitch(this, this.layerProcesser._onLayerInfosIsShowInMapChanged)));\n            this.own(layerInfosObj.on(\n              'layerInfosChanged',\n              lang.hitch(this, this.layerProcesser._onLayerInfosChanged)));\n\n            this._layerInfosDef.resolve(this.layerInfosObj);\n          }));\n        }\n\n        return this._layerInfosDef;\n      },\n\n      //miniModeTimer\n      // _clearMiniModeTimer: function () {\n      //   html.removeClass(this.domNode, 'mini-mode');\n      //   this._adaptResponsive({ refreshMoveable:false });\n      //   if (this._miniModeTimer) {\n      //     clearTimeout(this._miniModeTimer);\n      //   }\n      // },\n      // _setMiniModeTimer: function () {\n      //   var time = utils.isRunInMobile() ? 5000 : 2000;\n      //   this._miniModeTimer = setTimeout(lang.hitch(this, function () {\n      //     if (false === this.a11y_shownBy508) {\n      //       html.addClass(this.domNode, 'mini-mode');\n      //       this._adaptResponsive();\n      //     }\n      //   }), time);\n      // },\n\n      //moveable\n      makeMoveable: function (handleNode) {\n        this.disableMoveable();\n        var containerBox = domGeometry.getMarginBox(this.map.root);\n        //containerBox.l = containerBox.l - width + tolerance;\n        //containerBox.w = containerBox.w + 2 * (width - tolerance);\n        this.moveable = new Move.boxConstrainedMoveable(this.domNode, {\n          box: containerBox,\n          handle: handleNode || this.handleNode,\n          within: true\n        });\n        this.own(on(this.moveable, 'MoveStart', lang.hitch(this, this.onMoveStart)));\n        this.own(on(this.moveable, 'Moving', lang.hitch(this, this.onMoving)));\n        this.own(on(this.moveable, 'MoveStop', lang.hitch(this, this.onMoveStop)));\n      },\n      disableMoveable: function () {\n        if (this.moveable) {\n          this.dragHandler = null;\n          this.moveable.destroy();\n          this.moveable = null;\n        }\n      },\n      onMoveStart: function (mover) {\n        var containerBox = domGeometry.getMarginBox(this.map.root),\n          domBox = domGeometry.getMarginBox(this.domNode);\n        if (window.isRTL) {\n          var rightPx = html.getStyle(mover.node, 'right');\n          html.setStyle(mover.node, 'left', (containerBox.w - domBox.w - parseInt(rightPx, 10)) + 'px');\n          html.setStyle(mover.node, 'right', '');\n        }\n        //move flag\n        if (!this._draged) {\n          this._draged = true;\n        }\n      },\n      onMoving: function (/*mover*/) {\n        //html.setStyle(mover.node, 'opacity', 0.9);\n        this._moving = true;\n      },\n      onMoveStop: function (mover) {\n        if (mover && mover.node) {\n          html.setStyle(mover.node, 'opacity', 1);\n          var panelBox = domGeometry.getMarginBox(mover.node);\n          this.position.left = panelBox.l;\n          this.position.top = panelBox.t;\n          utils.getMarginPosition(this.map, this.domNode, this.position);\n\n          // save move data\n          setTimeout(lang.hitch(this, function () {\n            this._moving = false;\n          }), 10);\n        }\n      },\n      _onHandleClick: function(evt) {\n        evt.stopPropagation();\n      },\n\n      _ontoggleAirQ: function(evt) {\n        const airq_check = this.airq_toggle_node;\n        if (evt !== undefined) {\n          evt.stopPropagation();\n          if (this.airQLayer.isVisible()) {\n            this.airQLayer.hide();\n          } else {\n            this.airQLayer.show();\n          }\n        }\n        if (!this.airQLayer.isVisible()) {\n        //  uncheck\n          this.airq_checked = false;\n          // this.a11y_changeAriaCheckedAttr();\n          html.removeClass(airq_check, 'checked');\n          html.removeClass(airq_check, 'jimu-icon-checked');\n          html.addClass(airq_check, 'jimu-icon-checkbox');\n        } else {\n          // check\n          this.airq_checked = true;\n          // this.a11y_changeAriaCheckedAttr();\n          html.addClass(airq_check, 'checked jimu-icon-checked');\n          html.removeClass(airq_check, 'jimu-icon-checkbox');\n        }\n\n      },\n\n      //speed menu\n      _initSpeedMenu: function _initSpeedMenu() {\n        if (!this.speedMenu) {\n          this.speedMenuNode = html.create('div', { \"class\": \"jimu-float-trailing\" }, this.sliderContent);\n\n          this.speedMenu = new SpeedMenu({ nls: this.nls }, this.speedMenuNode);\n          this.speedMenuSelectedHanlder = this.own(on(this.speedMenu, 'selected', lang.hitch(this, function (rateStr) {\n            if (this.timeSlider && rateStr) {\n              this._LAST_SPEED_RATE = rateStr;\n              var rate = parseFloat(rateStr);\n              this.timeSlider.setThumbMovingRate(2000 / rate);\n            }\n          })));\n\n          // this.speedMenuOpenHanlder = this.own(on(this.speedMenu, 'open', lang.hitch(this, function () {\n          //   this._clearMiniModeTimer();\n          // })));\n          //\n          // this.speedMenuCloseHanlder = this.own(on(this.speedMenu, 'close', lang.hitch(this, function () {\n          //   this._setMiniModeTimer();\n          // })));\n\n          if (this._LAST_SPEED_RATE) {\n            this.speedMenu.setSpeed(this._LAST_SPEED_RATE);//keep speed when auto refresh\n          }\n        }\n      },\n      _destroySpeedMenu: function () {\n        if(this.speedMenu && this.speedMenu.destroy){\n          this.speedMenu.destroy();\n        }\n        this.speedMenu = null;\n        this.speedMenuSelectedHanlder = null;\n        this.speedMenuOpenHanlder = null;\n        this.speedMenuCloseHanlder = null;\n      }\n    });\n\n    clazz.extend(a11y);//for a11y\n    return clazz;\n  });\n"]}