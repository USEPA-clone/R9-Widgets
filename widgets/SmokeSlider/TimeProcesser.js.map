{"version":3,"sources":["../../../widgets/SmokeSlider/TimeProcesser.js"],"names":["define","declare","lang","dojoConfig","Evented","_WidgetBase","when","all","Deferred","esriRequest","utils","moment","dateLocale","i18n","esriLang","TimeExtent","clazz","nls","config","map","layerInfosObj","_INIT_TIME_STEAMP","setLayerInfosObj","_getUpdatedFullTime","i","len","layer","layerId","defs","layerIds","length","getLayer","push","_getUpdatedTime","graphicsLayerIds","then","hitch","timeExtents","_getFullTimeExtent","getFullTimeExtent","url","hasLiveData","timeExtent","callbackParamName","content","f","returnUpdates","result","startTime","Date","endTime","timeInfo","always","getObject","getUpdatedFullTime","setTimeSlider","timeSlider","getTime","_getTimeFormatLabel","label","start","end","thumbCount","timeStops","thumbIndexes","timeFormat","customDateFormat","format","datePattern","timePattern","formatLength","showEndDate","time","localeDic","locale","en","getFullYear","getMonth","getDate","getHours","getMinutes","getSeconds","millisecondTimePattern","secondTimePattern","minuteTimePattern","yearPattern","selector","startTime2","startTime3","getLocalization","replace","isValidDataStrByDateLocale","endTime2","endTime3","substitute","FROMTIME","ENDTIME","findDefaultInterval","fullTimeExtent","interval","units","timePerStop","century","Math","round","decade","year","month","week","day","hour","minute","second","getPropsFromMultiLayerInfos","timeInfos","ref","res","thumbMovingRate","getTsPros","def","itemInfo","timeSliderProps","tsProps","clone","resolve","findClosestThumbIndex","timeValue","lower","getCurrentTimeStops","timeStamp","setAutoRefreshTimer","autoRefresh","isAutoRefresh","_autoRefreshFlag","clearAutoRefreshTimer","getAutoRefreshTime","_autoRefreshTimer","setTimeout","stopsObj","saveToLocalCache","widgetId","_closeHanlder","_openHanlder","clearTimeout","restoreAutoRefreshTimer","autoRefreshStops","getCacheByKeys","setThumbCount","setThumbIndexes","hourTimePattern"],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEAA,OAAO,CAAC,oBAAD,EACL,iBADK,EAEL,mBAFK,EAGL,cAHK,EAIL,mBAJK,EAKL,WALK,EAML,kBANK,EAOL,eAPK,EAQL,cARK,EASL,SATK,EAUL,eAVK,EAWL,kBAXK,EAYL,WAZK,EAaL,WAbK,EAcL,iBAdK,CAAP,EAgBE,UAAUC,OAAV,EAAmBC,IAAnB,EAAyBC,UAAzB,EACEC,OADF,EACWC,WADX,EACwBC,IADxB,EAC8BC,GAD9B,EACmCC,QADnC,EAC6CC,WAD7C,EAEEC,KAFF,EAESC,MAFT,EAEiBC,UAFjB,EAE6BC,IAF7B,EAEmCC,QAFnC,EAE6CC,UAF7C,EAEyD;;AAEvD,MAAIC,QAAQf,QAAQ,CAACI,WAAD,EAAcD,OAAd,CAAR,EAAgC;AAC1Ca,SAAK,IADqC;AAE1CC,YAAQ,IAFkC;AAG1CC,SAAK,IAHqC;AAI1CC,mBAAe,IAJ2B;;AAM1CC,uBAAmB,IANuB,EAMlB;;AAExBC,sBAAkB,0BAAUF,aAAV,EAAyB;AACzC,WAAKA,aAAL,GAAqBA,aAArB;AACD,KAVyC;;AAY1CG,yBAAqB,+BAAY;AAC/B,UAAIC,IAAI,CAAR;AAAA,UACEC,GADF;AAAA,UACOC,KADP;AAAA,UACcC,OADd;AAEA,UAAIC,OAAO,EAAX;AACA,WAAKJ,IAAI,CAAJ,EAAOC,MAAM,KAAKN,GAAL,CAASU,QAAT,CAAkBC,MAApC,EAA4CN,IAAIC,GAAhD,EAAqDD,GAArD,EAA0D;AACxDG,kBAAU,KAAKR,GAAL,CAASU,QAAT,CAAkBL,CAAlB,CAAV;AACAE,gBAAQ,KAAKP,GAAL,CAASY,QAAT,CAAkBJ,OAAlB,CAAR;;AAEAC,aAAKI,IAAL,CAAU,KAAKC,eAAL,CAAqBP,KAArB,CAAV;AACD;;AAED,WAAKF,IAAI,CAAJ,EAAOC,MAAM,KAAKN,GAAL,CAASe,gBAAT,CAA0BJ,MAA5C,EAAoDN,IAAIC,GAAxD,EAA6DD,GAA7D,EAAkE;AAChEG,kBAAU,KAAKR,GAAL,CAASe,gBAAT,CAA0BV,CAA1B,CAAV;AACAE,gBAAQ,KAAKP,GAAL,CAASY,QAAT,CAAkBJ,OAAlB,CAAR;;AAEAC,aAAKI,IAAL,CAAU,KAAKC,eAAL,CAAqBP,KAArB,CAAV;AACD;;AAED,aAAOnB,IAAIqB,IAAJ,EAAUO,IAAV,CAAejC,KAAKkC,KAAL,CAAW,IAAX,EAAiB,UAAUC,WAAV,EAAuB;AAC5D,eAAO,KAAKC,kBAAL,CAAwBD,WAAxB,CAAP;AACD,OAFqB,CAAf,CAAP;AAGD,KAjCyC;;AAmC1CC,wBAAoB,4BAAUD,WAAV,EAAuB;AACzC,aAAO3B,MAAM6B,iBAAN,CAAwBF,WAAxB,CAAP;AACD,KArCyC;AAsC1C;AACAJ,qBAAiB,yBAAUP,KAAV,EAAiB;AAChC,UAAIA,SAASA,MAAMc,GAAf,IAAsB9B,MAAM+B,WAAN,CAAkBf,KAAlB,CAA1B,EAAoD;AAClD,YAAIgB,aAAa,IAAjB;AACA,eAAOjC,YAAY;AACjB+B,eAAKd,MAAMc,GADM;AAEjBG,6BAAmB,UAFF;AAGjBC,mBAAS;AACPC,eAAG,MADI;AAEPC,2BAAe;AAFR;AAHQ,SAAZ,EAOJX,IAPI,CAOCjC,KAAKkC,KAAL,CAAW,IAAX,EAAiB,UAAUW,MAAV,EAAkB;AACzC,cAAIA,OAAOL,UAAP,IAAqBK,OAAOL,UAAP,CAAkBZ,MAAlB,KAA6B,CAAtD,EAAyD;AACvDY,yBAAa,IAAI3B,UAAJ,EAAb;AACA2B,uBAAWM,SAAX,GAAuB,IAAIC,IAAJ,CAASF,OAAOL,UAAP,CAAkB,CAAlB,CAAT,CAAvB;AACAA,uBAAWQ,OAAX,GAAqB,IAAID,IAAJ,CAASF,OAAOL,UAAP,CAAkB,CAAlB,CAAT,CAArB;;AAEAhB,kBAAMyB,QAAN,CAAeT,UAAf,GAA4BA,UAA5B,CALuD,CAKhB;AACxC;AACF,SARO,CAPD,EAeHU,MAfG,CAeIlD,KAAKkC,KAAL,CAAW,IAAX,EAAiB,YAAY;AACtC,iBAAO9B,KAAKoC,cAAcxC,KAAKmD,SAAL,CAAe,qBAAf,EAAsC,KAAtC,EAA6C3B,KAA7C,CAAd,IAAqE,IAA1E,CAAP;AACD,SAFU,CAfJ,CAAP;AAkBD,OApBD,MAoBO;AACL,eAAOpB,KAAKJ,KAAKmD,SAAL,CAAe,qBAAf,EAAsC,KAAtC,EAA6C3B,KAA7C,KAAuD,IAA5D,CAAP;AACD;AACF,KA/DyC;;AAiE1C4B,wBAAoB,8BAAY;AAC9B,UAAI9B,IAAI,CAAR;AAAA,UACEC,GADF;AAAA,UACOC,KADP;AAAA,UACcC,OADd;AAEA,UAAIC,OAAO,EAAX;AACA,WAAKJ,IAAI,CAAJ,EAAOC,MAAM,KAAKN,GAAL,CAASU,QAAT,CAAkBC,MAApC,EAA4CN,IAAIC,GAAhD,EAAqDD,GAArD,EAA0D;AACxDG,kBAAU,KAAKR,GAAL,CAASU,QAAT,CAAkBL,CAAlB,CAAV;AACAE,gBAAQ,KAAKP,GAAL,CAASY,QAAT,CAAkBJ,OAAlB,CAAR;;AAEAC,aAAKI,IAAL,CAAU,KAAKC,eAAL,CAAqBP,KAArB,CAAV;AACD;;AAED,WAAKF,IAAI,CAAJ,EAAOC,MAAM,KAAKN,GAAL,CAASe,gBAAT,CAA0BJ,MAA5C,EAAoDN,IAAIC,GAAxD,EAA6DD,GAA7D,EAAkE;AAChEG,kBAAU,KAAKR,GAAL,CAASe,gBAAT,CAA0BV,CAA1B,CAAV;AACAE,gBAAQ,KAAKP,GAAL,CAASY,QAAT,CAAkBJ,OAAlB,CAAR;;AAEAC,aAAKI,IAAL,CAAU,KAAKC,eAAL,CAAqBP,KAArB,CAAV;AACD;;AAED,aAAOnB,IAAIqB,IAAJ,EAAUO,IAAV,CAAejC,KAAKkC,KAAL,CAAW,IAAX,EAAiB,UAAUC,WAAV,EAAuB;AAC5D,eAAO,KAAKC,kBAAL,CAAwBD,WAAxB,CAAP;AACD,OAFqB,CAAf,CAAP;AAGD,KAtFyC;;AAwF1C;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEAkB,mBAAe,uBAAUC,UAAV,EAAsB;AACnC,WAAKA,UAAL,GAAkBA,UAAlB;AACA,WAAKnC,iBAAL,GAAyB,IAAI4B,IAAJ,GAAWQ,OAAX,EAAzB,CAFmC,CAEW;AAC/C,KAtHyC;AAuH1CC,yBAAqB,6BAAUhB,UAAV,EAAsB;AACzC,UAAIiB,QAAQ,KAAK1C,GAAL,CAASyB,UAArB;AACA,UAAIkB,QAAQ,IAAZ;AACA,UAAIC,MAAM,IAAV;AACA,UAAIb,YAAY,EAAhB;AACA,UAAIE,UAAU,EAAd;;AAEA,UAAI,CAACR,UAAD,IAAe,KAAKc,UAAxB,EAAoC;AAClC;AACA,YAAI,KAAKA,UAAL,CAAgBM,UAAhB,KAA+B,CAAnC,EAAsC;AAAC;AACrCF,kBAAQ,KAAKJ,UAAL,CAAgBO,SAAhB,CAA0B,KAAKP,UAAL,CAAgBQ,YAAhB,CAA6B,CAA7B,CAA1B,CAAR;AACAH,gBAAM,KAAKL,UAAL,CAAgBO,SAAhB,CAA0B,KAAKP,UAAL,CAAgBQ,YAAhB,CAA6B,CAA7B,CAA1B,CAAN;AACD,SAHD,MAGO;AACLJ,kBAAQ,KAAKJ,UAAL,CAAgBO,SAAhB,CAA0B,KAAKP,UAAL,CAAgBQ,YAAhB,CAA6B,CAA7B,CAA1B,CAAR;AACD;AACF,OARD,MAQO,IAAI,CAACtB,UAAD,IAAe,CAAC,KAAKc,UAAzB,EAAqC;AAC1C;AACAG,gBAAQ,EAAR;AACA,eAAOA,KAAP;AACD,OAJM,MAIA;AACLC,gBAAQlB,WAAWM,SAAnB;AACA,YAAIN,WAAWQ,OAAX,CAAmBO,OAAnB,KAA+Bf,WAAWM,SAAX,CAAqBS,OAArB,EAA/B,GAAgE,CAApE,EAAuE;AACrEI,gBAAMnB,WAAWQ,OAAjB;AACD;AACF;;AAED,UAAI,KAAKhC,MAAL,CAAY+C,UAAZ,KAA2B,MAA3B,IACF,EAAE,aAAa,KAAK/C,MAAL,CAAY+C,UAAzB,IAAuC,OAAO,KAAK/C,MAAL,CAAYgD,gBAA5D,CADF,EACiF;;AAE/E,YAAIC,SAAU,aAAa,KAAKjD,MAAL,CAAY+C,UAAzB,GAAsC,KAAK/C,MAAL,CAAYgD,gBAAlD,GAAqE,KAAKhD,MAAL,CAAY+C,UAA/F;AACAjB,oBAAYrC,OAAOiD,MAAMH,OAAN,EAAP,EAAwBU,MAAxB,CAA+BA,MAA/B,CAAZ;AACA,YAAIN,GAAJ,EAAS;AACPX,oBAAUvC,OAAOkD,IAAIJ,OAAJ,EAAP,EAAsBU,MAAtB,CAA6BA,MAA7B,CAAV;AACD;AACF,OARD,MAQO;AACL;AACA,YAAIC,cAAc,IAAlB;AACA,YAAIC,cAAc,IAAlB;AACA,YAAIC,eAAe,IAAnB;AACA,YAAIC,cAAc,KAAlB;AACA,YAAIC,OAAOxD,MAAMyD,SAAN,CAAgBtE,WAAWuE,MAA3B,KAAsC1D,MAAMyD,SAAN,CAAgBE,EAAjE;AACA,YAAId,OAAOD,MAAMgB,WAAN,OAAwBf,IAAIe,WAAJ,EAAnC,EAAsD;AACpD,cAAIhB,MAAMiB,QAAN,OAAqBhB,IAAIgB,QAAJ,EAAzB,EAAyC;AACvC,gBAAIjB,MAAMkB,OAAN,OAAoBjB,IAAIiB,OAAJ,EAAxB,EAAuC;AACrC,kBAAIlB,MAAMmB,QAAN,OAAqBlB,IAAIkB,QAAJ,EAAzB,EAAyC;AACvC,oBAAInB,MAAMoB,UAAN,OAAuBnB,IAAImB,UAAJ,EAA3B,EAA6C;AAC3C,sBAAIpB,MAAMqB,UAAN,OAAuBpB,IAAIoB,UAAJ,EAA3B,EAA6C;AAC3C;AACAZ,kCAAcG,KAAKU,sBAAnB;AACAZ,mCAAe,MAAf;AACD,mBAJD,MAIO;AAAE;AACPD,kCAAcG,KAAKW,iBAAnB;AACAb,mCAAe,MAAf;AACD;AACF,iBATD,MASO;AAAE;AACPD,gCAAcG,KAAKY,iBAAnB;AACAd,iCAAe,MAAf;AACD;AACF,eAdD,MAcO;AAAE;AACPD,8BAAcG,KAAKY,iBAAnB,CADK,CACiC;AACtCd,+BAAe,MAAf;AACD;AACF,aAnBD,MAmBO;AAAE;AACP,kBAAIT,IAAIiB,OAAJ,KAAgBlB,MAAMkB,OAAN,EAAhB,GAAkC,CAAtC,EAAyC;AACvC;AACAT,8BAAcG,KAAKY,iBAAnB,CAFuC,CAED;AACtCb,8BAAc,IAAd;AACAD,+BAAe,MAAf;AACD,eALD,MAKO;AACLC,8BAAc,IAAd;AACAD,+BAAe,MAAf;AACD;AACF;AACF,WA/BD,MA+BO;AAAE;AACPC,0BAAc,IAAd;AACAD,2BAAe,MAAf;AACD;AACF,SApCD,MAoCO,IAAIT,OAAOA,IAAIe,WAAJ,KAAoBhB,MAAMgB,WAAN,EAApB,GAA0C,EAArD,EAAyD;AAC9DR,wBAAcI,KAAKa,WAAnB;AACAd,wBAAc,IAAd;AACD,SAHM,MAGA;AACLA,wBAAc,IAAd;AACAD,yBAAe,MAAf;AACD;;AAED;AACAtB,oBAAYpC,WAAWuD,MAAX,CAAkBP,KAAlB,EAAyB;AACnCQ,uBAAaA,WADsB;AAEnCE,wBAAcA,YAFqB;AAGnCgB,oBAAU;AAHyB,SAAzB,CAAZ;AAKA,YAAIjB,WAAJ,EAAiB;AACf,cAAIkB,aAAa3E,WAAWuD,MAAX,CAAkBP,KAAlB,EAAyB;AACxCS,yBAAaA,WAD2B;AAExCiB,sBAAU;AAF8B,WAAzB,CAAjB;AAIA,cAAIE,aAAa3E,KAAK4E,eAAL,CAAqB,WAArB,EAAkC,WAAlC,EAA+C,uBAA/C,EACdC,OADc,CACN,QADM,EACI1C,SADJ,EACe0C,OADf,CACuB,QADvB,EACiCH,UADjC,CAAjB;AAEAvC,sBAAYwC,UAAZ;AACD;AACD,YAAG,CAAC9E,MAAMiF,0BAAN,CAAiC3C,SAAjC,CAAJ,EAAgD;AAC9CA,sBAAY,EAAZ;AACD;;AAED;AACA,YAAIa,GAAJ,EAAS;AACP,cAAIU,WAAJ,EAAiB;AACfrB,sBAAUtC,WAAWuD,MAAX,CAAkBN,GAAlB,EAAuB;AAC/BO,2BAAaA,WADkB;AAE/BE,4BAAcA,YAFiB;AAG/BgB,wBAAU;AAHqB,aAAvB,CAAV;AAKD;AACD,cAAIjB,WAAJ,EAAiB;AACf,gBAAIuB,WAAWhF,WAAWuD,MAAX,CAAkBN,GAAlB,EAAuB;AACpCQ,2BAAaA,WADuB;AAEpCiB,wBAAU;AAF0B,aAAvB,CAAf;AAIA,gBAAIf,eAAeF,WAAnB,EAAgC;AAC9B,kBAAIwB,WAAWhF,KAAK4E,eAAL,CAAqB,WAArB,EAAkC,WAAlC,EAA+C,uBAA/C,EACZC,OADY,CACJ,QADI,EACMxC,OADN,EACewC,OADf,CACuB,QADvB,EACiCE,QADjC,CAAf;AAEA1C,wBAAU2C,QAAV;AACD,aAJD,MAIO;AACL3C,wBAAU0C,QAAV;AACD;AACF;AACF;;AAED,YAAG,CAAClF,MAAMiF,0BAAN,CAAiCzC,OAAjC,CAAJ,EAA8C;AAC5CA,oBAAU,EAAV;AACD;AACF;;AAED,UAAIW,GAAJ,EAAS;AACPF,gBAAQ7C,SAASgF,UAAT,CAAoB;AAC1BC,oBAAU/C,SADgB;AAE1BgD,mBAAS9C;AAFiB,SAApB,EAGLS,KAHK,CAAR;AAID,OALD,MAKO;AACLA,gBAAQX,YAAY,EAApB;AACD;AACD,aAAOW,KAAP;AACD,KArQyC;;AAuQ1CsC,yBAAqB,6BAAUC,cAAV,EAA0B;AAC7C,UAAIC,QAAJ;AACA,UAAIC,KAAJ;AACA,UAAIC,cAAc,CAACH,eAAehD,OAAf,CAAuBO,OAAvB,KAAmCyC,eAAelD,SAAf,CAAyBS,OAAzB,EAApC,IAA0E,EAA5F;AACA,UAAI6C,UAAU,OAAO,EAAP,GAAY,EAAZ,GAAiB,EAAjB,GAAsB,EAAtB,GAA2B,EAA3B,GAAgC,GAA9C;AACA,UAAID,cAAcC,OAAlB,EAA2B;AACzBH,mBAAWI,KAAKC,KAAL,CAAWH,cAAcC,OAAzB,CAAX;AACAF,gBAAQ,wBAAR;AACD,OAHD,MAGO;AACL,YAAIK,SAAS,OAAO,EAAP,GAAY,EAAZ,GAAiB,EAAjB,GAAsB,EAAtB,GAA2B,EAA3B,GAAgC,EAA7C;AACA,YAAIJ,cAAcI,MAAlB,EAA0B;AACxBN,qBAAWI,KAAKC,KAAL,CAAWH,cAAcI,MAAzB,CAAX;AACAL,kBAAQ,sBAAR;AACD,SAHD,MAGO;AACL,cAAIM,OAAO,OAAO,EAAP,GAAY,EAAZ,GAAiB,EAAjB,GAAsB,EAAtB,GAA2B,EAAtC;AACA,cAAIL,cAAcK,IAAlB,EAAwB;AACtBP,uBAAWI,KAAKC,KAAL,CAAWH,cAAcK,IAAzB,CAAX;AACAN,oBAAQ,oBAAR;AACD,WAHD,MAGO;AACL,gBAAIO,QAAQ,OAAO,EAAP,GAAY,EAAZ,GAAiB,EAAjB,GAAsB,EAAlC;AACA,gBAAIN,cAAcM,KAAlB,EAAyB;AACvBR,yBAAWI,KAAKC,KAAL,CAAWH,cAAcM,KAAzB,CAAX;AACAP,sBAAQ,qBAAR;AACD,aAHD,MAGO;AACL,kBAAIQ,OAAO,OAAO,EAAP,GAAY,EAAZ,GAAiB,EAAjB,GAAsB,CAAjC;AACA,kBAAIP,cAAcO,IAAlB,EAAwB;AACtBT,2BAAWI,KAAKC,KAAL,CAAWH,cAAcO,IAAzB,CAAX;AACAR,wBAAQ,oBAAR;AACD,eAHD,MAGO;AACL,oBAAIS,MAAM,OAAO,EAAP,GAAY,EAAZ,GAAiB,EAA3B;AACA,oBAAIR,cAAcQ,GAAlB,EAAuB;AACrBV,6BAAWI,KAAKC,KAAL,CAAWH,cAAcQ,GAAzB,CAAX;AACAT,0BAAQ,mBAAR;AACD,iBAHD,MAGO;AACL,sBAAIU,OAAO,OAAO,EAAP,GAAY,EAAvB;AACA,sBAAIT,cAAcS,IAAlB,EAAwB;AACtBX,+BAAWI,KAAKC,KAAL,CAAWH,cAAcS,IAAzB,CAAX;AACAV,4BAAQ,oBAAR;AACD,mBAHD,MAGO;AACL,wBAAIW,SAAS,OAAO,EAApB;AACA,wBAAIV,cAAcU,MAAlB,EAA0B;AACxBZ,iCAAWI,KAAKC,KAAL,CAAWH,cAAcU,MAAzB,CAAX;AACAX,8BAAQ,sBAAR;AACD,qBAHD,MAGO;AACL,0BAAIY,SAAS,IAAb;AACA,0BAAIX,cAAcW,MAAlB,EAA0B;AACxBb,mCAAWI,KAAKC,KAAL,CAAWH,cAAcW,MAAzB,CAAX;AACAZ,gCAAQ,sBAAR;AACD,uBAHD,MAGO;AACLD,mCAAWI,KAAKC,KAAL,CAAWH,WAAX,CAAX;AACAD,gCAAQ,2BAAR;AACD;AACF;AACF;AACF;AACF;AACF;AACF;AACF;AACF;;AAED,UAAI,MAAMD,QAAV,EAAoB;AAClBA,mBAAW,CAAX,CADkB,CACL;AACd;;AAED,aAAO;AACLA,kBAAUA,QADL;AAELC,eAAOA;AAFF,OAAP;AAID,KA5UyC;AA6U1Ca,iCAA6B,qCAAUC,SAAV,EAAqBC,GAArB,EAA0B;AACrD,UAAIC,MAAM,EAAV;AACA,UAAI,SAASD,GAAb,EAAkB;AAChBC,cAAMF,SAAN;AACAE,YAAItD,UAAJ,GAAiB,CAAjB;AACAsD,YAAIC,eAAJ,GAAsB,IAAtB;AACD,OAJD,MAIO;AACLD,cAAMD,GAAN;;AAEA,YAAID,UAAUxE,UAAV,CAAqB,CAArB,IAA0B0E,IAAI1E,UAAJ,CAAe,CAAf,CAA9B,EAAiD;AAC/C0E,cAAI1E,UAAJ,CAAe,CAAf,IAAoBwE,UAAUxE,UAAV,CAAqB,CAArB,CAApB;AACD;AACD,YAAIwE,UAAUxE,UAAV,CAAqB,CAArB,IAA0B0E,IAAI1E,UAAJ,CAAe,CAAf,CAA9B,EAAiD;AAC/C0E,cAAI1E,UAAJ,CAAe,CAAf,IAAoBwE,UAAUxE,UAAV,CAAqB,CAArB,CAApB;AACD;AACF;;AAED,aAAO0E,GAAP;AACD,KA/VyC;AAgW1CE,eAAW,qBAAY;AACrB;AACA;AACA;AACA,UAAIC,MAAM,IAAI/G,QAAJ,EAAV;AACA,UAAIgH,WAAW,KAAKrG,GAAL,IAAY,KAAKA,GAAL,CAASqG,QAApC;;AAEA,UAAIC,kBAAkBvH,KAAKmD,SAAL,CAAe,wCAAf,EACpB,KADoB,EACbmE,QADa,CAAtB;;AAGA,UAAIE,UAAU,EAAd;AACA,UAAID,eAAJ,EAAqB;AACnB;AACAC,kBAAUxH,KAAKyH,KAAL,CAAWF,eAAX,CAAV;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACAF,YAAIK,OAAJ,CAAYF,OAAZ;AACD,OAlCD,MAkCO;AACL;AACAH,YAAIK,OAAJ,CAAY,IAAZ;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA8CD;;AAED,aAAOL,GAAP;AACD,KAjcyC;AAkc1CM,2BAAuB,+BAASrE,UAAT,EAAqBsE,SAArB,EAAgC;AACrD,UAAI/D,YAAYP,WAAWO,SAA3B;AACA,UAAIgE,QAAQhE,UAAU,CAAV,CAAZ;AACA,UAAI+D,YAAYC,KAAhB,EAAuB;AACrB,eAAO,CAAP;AACD,OAFD,MAEO;AACL,aAAK,IAAIvG,IAAI,CAAb,EAAgBA,IAAIuC,UAAUjC,MAA9B,EAAsCN,GAAtC,EAA2C;AACzC,cAAIuC,UAAUvC,CAAV,KAAgBsG,SAApB,EAA+B;AAC7B,gBAAKA,YAAYC,KAAb,GAAuBhE,UAAUvC,CAAV,IAAesG,SAA1C,EAAsD;AACpD,qBAAQtG,IAAI,CAAZ;AACD,aAFD,MAEO;AACL,qBAAOA,CAAP;AACD;AACF,WAND,MAMO,IAAIA,IAAIuC,UAAUjC,MAAV,GAAmB,CAA3B,EAA8B;AACnCiG,oBAAQhE,UAAUvC,CAAV,CAAR;AACD,WAFM,MAEA;AACL;AACA,mBAAOA,CAAP;AACD;AACF;AACF;AACF,KAvdyC;AAwd1CwG,yBAAqB,6BAAUC,SAAV,EAAqB;AACxC,UAAIjF,YAAY,IAAhB;AAAA,UAAsBE,UAAU,IAAhC;;AAEA,UAAI,MAAM,KAAKM,UAAL,CAAgBM,UAA1B,EAAsC;AACpCd,oBAAY,KAAKQ,UAAL,CAAgBO,SAAhB,CAA0B,KAAKP,UAAL,CAAgBQ,YAAhB,CAA6B,CAA7B,CAA1B,CAAZ;AACD,OAFD,MAEO,IAAI,MAAM,KAAKR,UAAL,CAAgBM,UAA1B,EAAsC;AAC3Cd,oBAAY,KAAKQ,UAAL,CAAgBO,SAAhB,CAA0B,KAAKP,UAAL,CAAgBQ,YAAhB,CAA6B,CAA7B,CAA1B,CAAZ;AACAd,kBAAU,KAAKM,UAAL,CAAgBO,SAAhB,CAA0B,KAAKP,UAAL,CAAgBQ,YAAhB,CAA6B,CAA7B,CAA1B,CAAV;AACD;;AAED,aAAO;AACL;AACAiE,mBAAWA,SAFN;AAGLnE,oBAAY,KAAKN,UAAL,CAAgBM,UAHvB;AAILd,mBAAW,IAAIC,IAAJ,CAASD,SAAT,EAAoBS,OAApB,EAJN;AAKLP,iBAAS,IAAID,IAAJ,CAASC,OAAT,EAAkBO,OAAlB;AALJ,OAAP;AAOD,KAzeyC;;AA2e1C;AACAyE,yBAAqB,6BAAUf,GAAV,EAAe;AAClC,UAAIjG,SAAS,KAAKA,MAAlB;;AAEA,UAAI,EAAEA,UAAUA,OAAOiH,WAAjB,IAAgC,SAASjH,OAAOiH,WAAP,CAAmBC,aAA9D,CAAJ,EAAkF;AAChF,aAAKC,gBAAL,GAAwB,KAAxB;AACA,aAAKC,qBAAL;AACA;AACD;;AAED,WAAKD,gBAAL,GAAwB,IAAxB;;AAEA,UAAI7D,OAAO9D,MAAM6H,kBAAN,CAAyBrH,MAAzB,CAAX;AACA,UAAIsD,IAAJ,EAAU;AACR,aAAKgE,iBAAL,GAAyBC,WAAWvI,KAAKkC,KAAL,CAAW,IAAX,EAAiB,YAAY;AAC/D,cAAIsG,WAAW,KAAKV,mBAAL,CAAyB,KAAK3G,iBAA9B,CAAf;AACAX,gBAAMiI,gBAAN,CAAuB,KAAKC,QAA5B,EAAsCF,QAAtC;;AAEAvB,cAAI0B,aAAJ;AACA1B,cAAI2B,YAAJ;AACD,SANmC,CAAX,EAMrBtE,IANqB,CAAzB;AAOD;AACF,KAjgByC;AAkgB1C8D,2BAAuB,iCAAY;AACjC,UAAI,KAAKE,iBAAT,EAA4B;AAC1BO,qBAAa,KAAKP,iBAAlB;AACD;AACF,KAtgByC;AAugB1CQ,6BAAyB,iCAAUxF,UAAV,EAAsB;AAC7C,UAAIyF,mBAAmBvI,MAAMwI,cAAN,CAAqB,KAAKN,QAA1B,CAAvB,CAD6C,CACc;AAC3D,UAAIK,oBAAoBA,iBAAiBhB,SAArC,IAAkD,KAAK5G,iBAAL,KAA2B4H,iBAAiBhB,SAAlG,EAA6G;;AAE3G,YAAIrE,KAAJ,EAAWC,GAAX;AACAL,mBAAW2F,aAAX,CAAyBF,iBAAiBnF,UAA1C;;AAEAF,gBAAQ,KAAKiE,qBAAL,CAA2BrE,UAA3B,EAAuCyF,iBAAiBjG,SAAxD,CAAR;AACA,YAAI,MAAMQ,WAAWM,UAArB,EAAiC;AAC/BN,qBAAW4F,eAAX,CAA2B,CAACxF,KAAD,CAA3B;AACD,SAFD,MAEO,IAAI,MAAMJ,WAAWM,UAArB,EAAiC;AACtCD,gBAAM,KAAKgE,qBAAL,CAA2BrE,UAA3B,EAAuCyF,iBAAiB/F,OAAxD,CAAN;AACA;AACAM,qBAAW4F,eAAX,CAA2B,CAACxF,KAAD,EAAQC,GAAR,CAA3B;AACD;AACF;AACF;AAvhByC,GAAhC,CAAZ;;AA0hBA7C,QAAMyD,SAAN,GAAkB;AAChB,UAAM;AACJL,mBAAa,eADT,EAC0B;AAC9BiB,mBAAa,MAFT;AAGJgE,uBAAiB,KAHb,EAGoB;AACxBjE,yBAAmB,QAJf,EAIyB;AAC7BD,yBAAmB,WALf,EAK4B;AAChCD,8BAAwB,eANpB,CAMoC;AANpC,KADU;AAShB,UAAM;AACJd,mBAAa,cADT;AAEJiB,mBAAa,MAFT;AAGJgE,uBAAiB,GAHb;AAIJjE,yBAAmB,MAJf;AAKJD,yBAAmB,SALf;AAMJD,8BAAwB;AANpB,KATU;AAiBhB,UAAM;AACJd,mBAAa,cADT;AAEJiB,mBAAa,MAFT;AAGJgE,uBAAiB,GAHb;AAIJjE,yBAAmB,MAJf;AAKJD,yBAAmB,SALf;AAMJD,8BAAwB;AANpB,KAjBU;AAyBhB,UAAM;AACJd,mBAAa,cADT;AAEJiB,mBAAa,MAFT;AAGJgE,uBAAiB,GAHb;AAIJjE,yBAAmB,MAJf;AAKJD,yBAAmB,SALf;AAMJD,8BAAwB;AANpB,KAzBU;AAiChB,UAAM;AACJd,mBAAa,aADT;AAEJiB,mBAAa,MAFT;AAGJgE,uBAAiB,GAHb;AAIJjE,yBAAmB,OAJf;AAKJD,yBAAmB,UALf;AAMJD,8BAAwB;AANpB,KAjCU;AAyChB,UAAM;AACJd,mBAAa,2BADT;AAEJiB,mBAAa,MAFT;AAGJgE,uBAAiB,GAHb;AAIJjE,yBAAmB,MAJf;AAKJD,yBAAmB,SALf;AAMJD,8BAAwB;AANpB,KAzCU;AAiDhB,UAAM;AACJd,mBAAa,cADT;AAEJiB,mBAAa,MAFT;AAGJgE,uBAAiB,GAHb;AAIJjE,yBAAmB,MAJf;AAKJD,yBAAmB,SALf;AAMJD,8BAAwB;AANpB,KAjDU;AAyDhB,UAAM;AACJd,mBAAa,cADT;AAEJiB,mBAAa,MAFT;AAGJgE,uBAAiB,GAHb;AAIJjE,yBAAmB,QAJf;AAKJD,yBAAmB,SALf;AAMJD,8BAAwB;AANpB,KAzDU;AAiEhB,UAAM;AACJd,mBAAa,aADT;AAEJiB,mBAAa,MAFT;AAGJgE,uBAAiB,IAHb;AAIJjE,yBAAmB,OAJf;AAKJD,yBAAmB,UALf;AAMJD,8BAAwB;AANpB,KAjEU;AAyEhB,UAAM;AACJd,mBAAa,eADT;AAEJiB,mBAAa,MAFT;AAGJgE,uBAAiB,KAHb;AAIJjE,yBAAmB,QAJf;AAKJD,yBAAmB,WALf;AAMJD,8BAAwB;AANpB,KAzEU;AAiFhB,UAAM;AACJd,mBAAa,aADT;AAEJiB,mBAAa,MAFT;AAGJgE,uBAAiB,GAHb;AAIJjE,yBAAmB,MAJf;AAKJD,yBAAmB,SALf;AAMJD,8BAAwB;AANpB,KAjFU;AAyFhB,UAAM;AACJd,mBAAa,iBADT;AAEJiB,mBAAa,SAFT;AAGJgE,uBAAiB,KAHb;AAIJjE,yBAAmB,QAJf;AAKJD,yBAAmB,WALf;AAMJD,8BAAwB;AANpB,KAzFU;AAiGhB,UAAM;AACJd,mBAAa,aADT;AAEJiB,mBAAa,OAFT;AAGJgE,uBAAiB,MAHb;AAIJjE,yBAAmB,QAJf;AAKJD,yBAAmB,WALf;AAMJD,8BAAwB;AANpB,KAjGU;AAyGhB,UAAM;AACJd,mBAAa,cADT;AAEJiB,mBAAa,MAFT;AAGJgE,uBAAiB,KAHb;AAIJjE,yBAAmB,OAJf;AAKJD,yBAAmB,UALf;AAMJD,8BAAwB;AANpB,KAzGU;AAiHhB,UAAM;AACJd,mBAAa,YADT;AAEJiB,mBAAa,MAFT;AAGJgE,uBAAiB,KAHb;AAIJjE,yBAAmB,OAJf;AAKJD,yBAAmB,UALf;AAMJD,8BAAwB;AANpB,KAjHU;AAyHhB,UAAM;AACJd,mBAAa,cADT;AAEJiB,mBAAa,MAFT;AAGJgE,uBAAiB,GAHb;AAIJjE,yBAAmB,MAJf;AAKJD,yBAAmB,SALf;AAMJD,8BAAwB;AANpB,KAzHU;AAiIhB,UAAM;AACJd,mBAAa,cADT;AAEJiB,mBAAa,MAFT;AAGJgE,uBAAiB,GAHb;AAIJjE,yBAAmB,MAJf;AAKJD,yBAAmB,SALf;AAMJD,8BAAwB;AANpB,KAjIU;AAyIhB,UAAM;AACJd,mBAAa,YADT;AAEJiB,mBAAa,MAFT;AAGJgE,uBAAiB,IAHb;AAIJjE,yBAAmB,OAJf;AAKJD,yBAAmB,UALf;AAMJD,8BAAwB;AANpB,KAzIU;AAiJhB,aAAS;AACPd,mBAAa,2BADN;AAEPiB,mBAAa,MAFN;AAGPgE,uBAAiB,GAHV;AAIPjE,yBAAmB,QAJZ;AAKPD,yBAAmB,SALZ;AAMPD,8BAAwB;AANjB,KAjJO;AAyJhB,aAAS;AACPd,mBAAa,2BADN;AAEPiB,mBAAa,MAFN;AAGPgE,uBAAiB,GAHV;AAIPjE,yBAAmB,MAJZ;AAKPD,yBAAmB,SALZ;AAMPD,8BAAwB;AANjB,KAzJO;AAiKhB,UAAM;AACJd,mBAAa,cADT;AAEJiB,mBAAa,MAFT;AAGJgE,uBAAiB,GAHb;AAIJjE,yBAAmB,MAJf;AAKJD,yBAAmB,SALf;AAMJD,8BAAwB;AANpB,KAjKU;AAyKhB,UAAM;AACJd,mBAAa,cADT;AAEJiB,mBAAa,MAFT;AAGJgE,uBAAiB,GAHb;AAIJjE,yBAAmB,MAJf;AAKJD,yBAAmB,SALf;AAMJD,8BAAwB;AANpB,KAzKU;AAiLhB,UAAM;AACJd,mBAAa,cADT;AAEJiB,mBAAa,MAFT;AAGJgE,uBAAiB,KAHb;AAIJjE,yBAAmB,QAJf;AAKJD,yBAAmB,WALf;AAMJD,8BAAwB;AANpB,KAjLU;AAyLhB,UAAM;AACJd,mBAAa,aADT;AAEJiB,mBAAa,MAFT;AAGJgE,uBAAiB,KAHb;AAIJjE,yBAAmB,QAJf;AAKJD,yBAAmB,WALf;AAMJD,8BAAwB;AANpB,KAzLU;AAiMhB,UAAM;AACJd,mBAAa,aADT;AAEJiB,mBAAa,MAFT;AAGJgE,uBAAiB,KAHb;AAIJjE,yBAAmB,QAJf;AAKJD,yBAAmB,WALf;AAMJD,8BAAwB;AANpB,KAjMU;AAyMhB,UAAM;AACJd,mBAAa,cADT;AAEJiB,mBAAa,MAFT;AAGJgE,uBAAiB,KAHb;AAIJjE,yBAAmB,QAJf;AAKJD,yBAAmB,WALf;AAMJD,8BAAwB;AANpB,KAzMU;AAiNhB,aAAS;AACPd,mBAAa,iBADN;AAEPiB,mBAAa,SAFN;AAGPgE,uBAAiB,GAHV;AAIPjE,yBAAmB,MAJZ;AAKPD,yBAAmB,SALZ;AAMPD,8BAAwB;AANjB,KAjNO;AAyNhB,aAAS;AACPd,mBAAa,KADN;AAEPiB,mBAAa,MAFN;AAGPgE,uBAAiB,KAHV;AAIPjE,yBAAmB,QAJZ;AAKPD,yBAAmB,WALZ;AAMPD,8BAAwB;AANjB,KAzNO;AAiOhB,aAAS;AACPd,mBAAa,KADN;AAEPiB,mBAAa,MAFN;AAGPgE,uBAAiB,KAHV;AAIPjE,yBAAmB,QAJZ;AAKPD,yBAAmB,WALZ;AAMPD,8BAAwB;AANjB,KAjOO;AAyOhB,UAAM;AACJd,mBAAa,cADT;AAEJiB,mBAAa,MAFT;AAGJgE,uBAAiB,KAHb;AAIJjE,yBAAmB,QAJf;AAKJD,yBAAmB,WALf;AAMJD,8BAAwB;AANpB;AAzOU,GAAlB;;AAmPA,SAAOlE,KAAP;AACD,CAlyBH","file":"TimeProcesser.js","sourcesContent":["///////////////////////////////////////////////////////////////////////////\n// Copyright © Esri. All Rights Reserved.\n//\n// Licensed under the Apache License Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//    http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n///////////////////////////////////////////////////////////////////////////\n\ndefine(['dojo/_base/declare',\n  'dojo/_base/lang',\n  'dojo/_base/config',\n  'dojo/Evented',\n  'dijit/_WidgetBase',\n  'dojo/when',\n  'dojo/promise/all',\n  'dojo/Deferred',\n  'esri/request',\n  './utils',\n  'moment/moment',\n  'dojo/date/locale',\n  'dojo/i18n',\n  'esri/lang',\n  'esri/TimeExtent'\n],\n  function (declare, lang, dojoConfig,\n    Evented, _WidgetBase, when, all, Deferred, esriRequest,\n    utils, moment, dateLocale, i18n, esriLang, TimeExtent) {\n\n    var clazz = declare([_WidgetBase, Evented], {\n      nls: null,\n      config: null,\n      map: null,\n      layerInfosObj: null,\n\n      _INIT_TIME_STEAMP: null,//for AutoRefresh\n\n      setLayerInfosObj: function (layerInfosObj) {\n        this.layerInfosObj = layerInfosObj;\n      },\n\n      _getUpdatedFullTime: function () {\n        var i = 0,\n          len, layer, layerId;\n        var defs = [];\n        for (i = 0, len = this.map.layerIds.length; i < len; i++) {\n          layerId = this.map.layerIds[i];\n          layer = this.map.getLayer(layerId);\n\n          defs.push(this._getUpdatedTime(layer));\n        }\n\n        for (i = 0, len = this.map.graphicsLayerIds.length; i < len; i++) {\n          layerId = this.map.graphicsLayerIds[i];\n          layer = this.map.getLayer(layerId);\n\n          defs.push(this._getUpdatedTime(layer));\n        }\n\n        return all(defs).then(lang.hitch(this, function (timeExtents) {\n          return this._getFullTimeExtent(timeExtents);\n        }));\n      },\n\n      _getFullTimeExtent: function (timeExtents) {\n        return utils.getFullTimeExtent(timeExtents);\n      },\n      //update liveData timeExtent\n      _getUpdatedTime: function (layer) {\n        if (layer && layer.url && utils.hasLiveData(layer)) {\n          var timeExtent = null;\n          return esriRequest({\n            url: layer.url,\n            callbackParamName: 'callback',\n            content: {\n              f: 'json',\n              returnUpdates: true\n            }\n          }).then(lang.hitch(this, function (result) {\n            if (result.timeExtent && result.timeExtent.length === 2) {\n              timeExtent = new TimeExtent();\n              timeExtent.startTime = new Date(result.timeExtent[0]);\n              timeExtent.endTime = new Date(result.timeExtent[1]);\n\n              layer.timeInfo.timeExtent = timeExtent;//update live data\n            }\n          })).always(lang.hitch(this, function () {\n            return when(timeExtent || lang.getObject('timeInfo.timeExtent', false, layer) || null);\n          }));\n        } else {\n          return when(lang.getObject('timeInfo.timeExtent', false, layer) || null);\n        }\n      },\n\n      getUpdatedFullTime: function () {\n        var i = 0,\n          len, layer, layerId;\n        var defs = [];\n        for (i = 0, len = this.map.layerIds.length; i < len; i++) {\n          layerId = this.map.layerIds[i];\n          layer = this.map.getLayer(layerId);\n\n          defs.push(this._getUpdatedTime(layer));\n        }\n\n        for (i = 0, len = this.map.graphicsLayerIds.length; i < len; i++) {\n          layerId = this.map.graphicsLayerIds[i];\n          layer = this.map.getLayer(layerId);\n\n          defs.push(this._getUpdatedTime(layer));\n        }\n\n        return all(defs).then(lang.hitch(this, function (timeExtents) {\n          return this._getFullTimeExtent(timeExtents);\n        }));\n      },\n\n      // needUpdateFullTime: function () {\n      //   var i = 0, len, layer, layerId;\n      //   for (i = 0, len = this.map.layerIds.length; i < len; i++) {\n      //     layerId = this.map.layerIds[i];\n      //     layer = this.map.getLayer(layerId);\n\n      //     if (utils.hasLiveData(layer)) {\n      //       return true;\n      //     }\n      //   }\n\n      //   for (i = 0, len = this.map.graphicsLayerIds.length; i < len; i++) {\n      //     layerId = this.map.graphicsLayerIds[i];\n      //     layer = this.map.getLayer(layerId);\n\n      //     if (utils.hasLiveData(layer)) {\n      //       return true;\n      //     }\n      //   }\n\n      //   return false;\n      // },\n      // hasLiveData: function (layer) {\n      //   // doesn't need to consider KMLLayers\n      //   return layer && layer.useMapTime && layer.timeInfo && layer.timeInfo.hasLiveData;\n      // },\n\n      setTimeSlider: function (timeSlider) {\n        this.timeSlider = timeSlider;\n        this._INIT_TIME_STEAMP = new Date().getTime();//for AutoRefresh\n      },\n      _getTimeFormatLabel: function (timeExtent) {\n        var label = this.nls.timeExtent;\n        var start = null;\n        var end = null;\n        var startTime = \"\";\n        var endTime = \"\";\n\n        if (!timeExtent && this.timeSlider) {\n          //var startTime =\n          if (this.timeSlider.thumbCount === 2) {//TODO\n            start = this.timeSlider.timeStops[this.timeSlider.thumbIndexes[0]];\n            end = this.timeSlider.timeStops[this.timeSlider.thumbIndexes[1]];\n          } else {\n            start = this.timeSlider.timeStops[this.timeSlider.thumbIndexes[0]];\n          }\n        } else if (!timeExtent && !this.timeSlider) {\n          //No time-aware layers\n          label = \"\";\n          return label;\n        } else {\n          start = timeExtent.startTime;\n          if (timeExtent.endTime.getTime() - timeExtent.startTime.getTime() > 0) {\n            end = timeExtent.endTime;\n          }\n        }\n\n        if (this.config.timeFormat !== \"auto\" &&\n          !(\"Custom\" === this.config.timeFormat && \"\" === this.config.customDateFormat)) {\n\n          var format = (\"Custom\" === this.config.timeFormat ? this.config.customDateFormat : this.config.timeFormat);\n          startTime = moment(start.getTime()).format(format);\n          if (end) {\n            endTime = moment(end.getTime()).format(format);\n          }\n        } else {\n          //auto mode\n          var datePattern = null;\n          var timePattern = null;\n          var formatLength = null;\n          var showEndDate = false;\n          var time = clazz.localeDic[dojoConfig.locale] || clazz.localeDic.en;\n          if (end && start.getFullYear() === end.getFullYear()) {\n            if (start.getMonth() === end.getMonth()) {\n              if (start.getDate() === end.getDate()) {\n                if (start.getHours() === end.getHours()) {\n                  if (start.getMinutes() === end.getMinutes()) {\n                    if (start.getSeconds() === end.getSeconds()) {\n                      // same second\n                      timePattern = time.millisecondTimePattern;\n                      formatLength = \"long\";\n                    } else { // same minute\n                      timePattern = time.secondTimePattern;\n                      formatLength = \"long\";\n                    }\n                  } else { // same hour\n                    timePattern = time.minuteTimePattern;\n                    formatLength = \"long\";\n                  }\n                } else { // same day\n                  timePattern = time.minuteTimePattern; //hourTimePattern;\n                  formatLength = \"long\";\n                }\n              } else { // same month\n                if (end.getDate() - start.getDate() < 2) {\n                  // less than 2 days\n                  timePattern = time.minuteTimePattern; //hourTimePattern;\n                  showEndDate = true;\n                  formatLength = \"long\";\n                } else {\n                  showEndDate = true;\n                  formatLength = \"long\";\n                }\n              }\n            } else { // same year\n              showEndDate = true;\n              formatLength = \"long\";\n            }\n          } else if (end && end.getFullYear() - start.getFullYear() > 10) {\n            datePattern = time.yearPattern;\n            showEndDate = true;\n          } else {\n            showEndDate = true;\n            formatLength = \"long\";\n          }\n\n          //start\n          startTime = dateLocale.format(start, {\n            datePattern: datePattern,\n            formatLength: formatLength,\n            selector: \"date\"\n          });\n          if (timePattern) {\n            var startTime2 = dateLocale.format(start, {\n              timePattern: timePattern,\n              selector: \"time\"\n            });\n            var startTime3 = i18n.getLocalization(\"dojo.cldr\", \"gregorian\")[\"dateTimeFormat-medium\"]\n              .replace(/\\{1\\}/g, startTime).replace(/\\{0\\}/g, startTime2);\n            startTime = startTime3;\n          }\n          if(!utils.isValidDataStrByDateLocale(startTime)){\n            startTime = \"\";\n          }\n\n          //end\n          if (end) {\n            if (showEndDate) {\n              endTime = dateLocale.format(end, {\n                datePattern: datePattern,\n                formatLength: formatLength,\n                selector: \"date\"\n              });\n            }\n            if (timePattern) {\n              var endTime2 = dateLocale.format(end, {\n                timePattern: timePattern,\n                selector: \"time\"\n              });\n              if (showEndDate && timePattern) {\n                var endTime3 = i18n.getLocalization(\"dojo.cldr\", \"gregorian\")[\"dateTimeFormat-medium\"]\n                  .replace(/\\{1\\}/g, endTime).replace(/\\{0\\}/g, endTime2);\n                endTime = endTime3;\n              } else {\n                endTime = endTime2;\n              }\n            }\n          }\n\n          if(!utils.isValidDataStrByDateLocale(endTime)){\n            endTime = \"\";\n          }\n        }\n\n        if (end) {\n          label = esriLang.substitute({\n            FROMTIME: startTime,\n            ENDTIME: endTime\n          }, label);\n        } else {\n          label = startTime + \"\";\n        }\n        return label;\n      },\n\n      findDefaultInterval: function (fullTimeExtent) {\n        var interval;\n        var units;\n        var timePerStop = (fullTimeExtent.endTime.getTime() - fullTimeExtent.startTime.getTime()) / 10;\n        var century = 1000 * 60 * 60 * 24 * 30 * 12 * 100;\n        if (timePerStop > century) {\n          interval = Math.round(timePerStop / century);\n          units = \"esriTimeUnitsCenturies\";\n        } else {\n          var decade = 1000 * 60 * 60 * 24 * 30 * 12 * 10;\n          if (timePerStop > decade) {\n            interval = Math.round(timePerStop / decade);\n            units = \"esriTimeUnitsDecades\";\n          } else {\n            var year = 1000 * 60 * 60 * 24 * 30 * 12;\n            if (timePerStop > year) {\n              interval = Math.round(timePerStop / year);\n              units = \"esriTimeUnitsYears\";\n            } else {\n              var month = 1000 * 60 * 60 * 24 * 30;\n              if (timePerStop > month) {\n                interval = Math.round(timePerStop / month);\n                units = \"esriTimeUnitsMonths\";\n              } else {\n                var week = 1000 * 60 * 60 * 24 * 7;\n                if (timePerStop > week) {\n                  interval = Math.round(timePerStop / week);\n                  units = \"esriTimeUnitsWeeks\";\n                } else {\n                  var day = 1000 * 60 * 60 * 24;\n                  if (timePerStop > day) {\n                    interval = Math.round(timePerStop / day);\n                    units = \"esriTimeUnitsDays\";\n                  } else {\n                    var hour = 1000 * 60 * 60;\n                    if (timePerStop > hour) {\n                      interval = Math.round(timePerStop / hour);\n                      units = \"esriTimeUnitsHours\";\n                    } else {\n                      var minute = 1000 * 60;\n                      if (timePerStop > minute) {\n                        interval = Math.round(timePerStop / minute);\n                        units = \"esriTimeUnitsMinutes\";\n                      } else {\n                        var second = 1000;\n                        if (timePerStop > second) {\n                          interval = Math.round(timePerStop / second);\n                          units = \"esriTimeUnitsSeconds\";\n                        } else {\n                          interval = Math.round(timePerStop);\n                          units = \"esriTimeUnitsMilliseconds\";\n                        }\n                      }\n                    }\n                  }\n                }\n              }\n            }\n          }\n        }\n\n        if (0 === interval) {\n          interval = 1;//skip api bug, when 0===interval\n        }\n\n        return {\n          interval: interval,\n          units: units\n        };\n      },\n      getPropsFromMultiLayerInfos: function (timeInfos, ref) {\n        var res = {};\n        if (null === ref) {\n          res = timeInfos;\n          res.thumbCount = 2;\n          res.thumbMovingRate = 2000;\n        } else {\n          res = ref;\n\n          if (timeInfos.timeExtent[0] < res.timeExtent[0]) {\n            res.timeExtent[0] = timeInfos.timeExtent[0];\n          }\n          if (timeInfos.timeExtent[1] > res.timeExtent[1]) {\n            res.timeExtent[1] = timeInfos.timeExtent[1];\n          }\n        }\n\n        return res;\n      },\n      getTsPros: function () {\n        //get all layers timeInfos\n        //from min time -> max time\n        //use suitable TimeInterval(method form mapViewer)\n        var def = new Deferred();\n        var itemInfo = this.map && this.map.itemInfo;\n\n        var timeSliderProps = lang.getObject('itemData.widgets.timeSlider.properties',\n          false, itemInfo);\n\n        var tsProps = {};\n        if (timeSliderProps) {\n          //1. props from mapViwer\n          tsProps = lang.clone(timeSliderProps);\n\n          // var operLayers = lang.getObject('itemData.operationalLayers', false, itemInfo);\n          // if (operLayers) {\n          //   //TODO not sure\n          //   tsProps.disabledLayers = array.map(operLayers, lang.hitch(this, function (layer) {\n          //     var layerInfo = layer.layerObject;\n\n          //     var isTimeEnabled = layerInfo.timeInfo && layerInfo.timeInfo.timeExtent; //&& !parameterList.layer.timeInfo.hasLiveData;\n          //     var usesTime = true;\n          //     if (\"undefined\" !== typeof layer.itemProperties.timeAnimation) {\n          //       usesTime = false;// arcgis-portal-app-master\\src\\js\\arcgisonline\\map\\itemData.js Line#205\n          //     }\n          //     if (false === layer.timeAnimation) {\n          //       usesTime = false;\n          //     }\n          //     if (true === layer.timeAnimation) {\n          //       usesTime = true;\n          //     }\n          //     if (\"undefined\" !== typeof layer.itemProperties.timeAnimation &&\n          //       \"undefined\" !== typeof layer.timeAnimation) {\n          //       usesTime = true;\n          //     }\n\n          //     return {\n          //       layerId: layer.id,\n          //       layerUrl: layer.url,\n          //       isTimeEnabled: !!(usesTime && isTimeEnabled)\n          //     };\n          //   }));\n          //}\n          def.resolve(tsProps);\n        } else {\n          //TODO return null , if there is no config in mapViwer\n          def.resolve(null);\n          /*\n          //2. props from map.itemInfo\n          var layers = lang.getObject('itemData.operationalLayers', false, itemInfo);\n          if (layers) {\n            var ref = null;\n            for (var i = 0, len = layers.length; i < len; i++) {\n              var layer = layers[i];\n              var timeInfos = lang.getObject('resourceInfo.timeInfo', false, layer);\n\n              if (timeInfos && timeInfos.timeExtent) {\n                ref = this.getPropsFromMultiLayerInfos(timeInfos, ref);\n              }\n            }\n\n            if (null !== ref) {\n              ref.startTime = ref.timeExtent[0];\n              ref.endTime = ref.timeExtent[1];\n              ref._needToFindDefaultInterval = true;\n\n              tsProps = ref;\n              def.resolve(tsProps);\n            } else {\n              //4. no props\n              def.resolve(null);\n            }\n            //   //3. props from services\n            // //   esriRequest({\n            // //     url: layers.url,\n            // //     content: {\n            // //       f: 'json'\n            // //     },\n            // //     handleAs: 'json',\n            // //     callbackParamName: 'callback'\n            // //   }).then(lang.hitch(this, function (res) {\n\n            // //   }), lang.hitch(this, function () {\n            // //     //4. no props\n            // //     def.resolve(null);\n            // //   }));\n            //  }\n            //          } else {\n            //4. no props\n            //            return def.resolve(null);\n          } else {\n            def.resolve(null);\n          }*/\n        }\n\n        return def;\n      },\n      findClosestThumbIndex: function(timeSlider, timeValue) {\n        var timeStops = timeSlider.timeStops;\n        var lower = timeStops[0];\n        if (timeValue < lower) {\n          return 0;\n        } else {\n          for (var i = 1; i < timeStops.length; i++) {\n            if (timeStops[i] >= timeValue) {\n              if ((timeValue - lower) < (timeStops[i] - timeValue)) {\n                return (i - 1);\n              } else {\n                return i;\n              }\n            } else if (i < timeStops.length - 1) {\n              lower = timeStops[i];\n            } else {\n              // out of upper range\n              return i;\n            }\n          }\n        }\n      },\n      getCurrentTimeStops: function (timeStamp) {\n        var startTime = null, endTime = null;\n\n        if (1 === this.timeSlider.thumbCount) {\n          startTime = this.timeSlider.timeStops[this.timeSlider.thumbIndexes[0]];\n        } else if (2 === this.timeSlider.thumbCount) {\n          startTime = this.timeSlider.timeStops[this.timeSlider.thumbIndexes[0]];\n          endTime = this.timeSlider.timeStops[this.timeSlider.thumbIndexes[1]];\n        }\n\n        return {\n          //TODO interval:\n          timeStamp: timeStamp,\n          thumbCount: this.timeSlider.thumbCount,\n          startTime: new Date(startTime).getTime(),\n          endTime: new Date(endTime).getTime()\n        };\n      },\n\n      //Auto Refresh\n      setAutoRefreshTimer: function (ref) {\n        var config = this.config;\n\n        if (!(config && config.autoRefresh && true === config.autoRefresh.isAutoRefresh)) {\n          this._autoRefreshFlag = false;\n          this.clearAutoRefreshTimer();\n          return;\n        }\n\n        this._autoRefreshFlag = true;\n\n        var time = utils.getAutoRefreshTime(config);\n        if (time) {\n          this._autoRefreshTimer = setTimeout(lang.hitch(this, function () {\n            var stopsObj = this.getCurrentTimeStops(this._INIT_TIME_STEAMP);\n            utils.saveToLocalCache(this.widgetId, stopsObj);\n\n            ref._closeHanlder();\n            ref._openHanlder();\n          }), time);\n        }\n      },\n      clearAutoRefreshTimer: function () {\n        if (this._autoRefreshTimer) {\n          clearTimeout(this._autoRefreshTimer);\n        }\n      },\n      restoreAutoRefreshTimer: function (timeSlider) {\n        var autoRefreshStops = utils.getCacheByKeys(this.widgetId);//timeSteamp\n        if (autoRefreshStops && autoRefreshStops.timeStamp && this._INIT_TIME_STEAMP === autoRefreshStops.timeStamp) {\n\n          var start, end;\n          timeSlider.setThumbCount(autoRefreshStops.thumbCount);\n\n          start = this.findClosestThumbIndex(timeSlider, autoRefreshStops.startTime);\n          if (1 === timeSlider.thumbCount) {\n            timeSlider.setThumbIndexes([start]);\n          } else if (2 === timeSlider.thumbCount) {\n            end = this.findClosestThumbIndex(timeSlider, autoRefreshStops.endTime);\n            //TODO if(start===end){\n            timeSlider.setThumbIndexes([start, end]);\n          }\n        }\n      }\n    });\n\n    clazz.localeDic = {\n      'ar': {\n        datePattern: \"dd MMMM, yyyy\", // e.g. for German: \"d. MMMM yyyy\"\n        yearPattern: \"yyyy\",\n        hourTimePattern: \"h a\", // e.g. for German: \"H\"\n        minuteTimePattern: \"h:mm a\", // e.g. for German: \"H:mm\"\n        secondTimePattern: \"h:mm:ss a\", // e.g. for German: \"H:mm:ss\"\n        millisecondTimePattern: \"h:mm:ss:SSS a\" // e.g. for German: \"H:mm:ss:SSS\"\n      },\n      'cs': {\n        datePattern: \"MMMM d, yyyy\",\n        yearPattern: \"yyyy\",\n        hourTimePattern: \"H\",\n        minuteTimePattern: \"h:mm\",\n        secondTimePattern: \"H:mm:ss\",\n        millisecondTimePattern: \"H:mm:ss:SSS\"\n      },\n      'da': {\n        datePattern: \"d. MMMM yyyy\",\n        yearPattern: \"yyyy\",\n        hourTimePattern: \"H\",\n        minuteTimePattern: \"H:mm\",\n        secondTimePattern: \"H:mm:ss\",\n        millisecondTimePattern: \"H:mm:ss:SSS\"\n      },\n      'de': {\n        datePattern: \"d. MMMM yyyy\",\n        yearPattern: \"yyyy\",\n        hourTimePattern: \"H\",\n        minuteTimePattern: \"H:mm\",\n        secondTimePattern: \"H:mm:ss\",\n        millisecondTimePattern: \"H:mm:ss:SSS\"\n      },\n      'el': {\n        datePattern: \"d MMMM yyyy\",\n        yearPattern: \"yyyy\",\n        hourTimePattern: \"h\",\n        minuteTimePattern: \"hh:mm\",\n        secondTimePattern: \"hh:mm:ss\",\n        millisecondTimePattern: \"hh:mm:ss:SSS\"\n      },\n      'es': {\n        datePattern: \"d\\' de \\'MMMM\\' de \\'yyyy\",\n        yearPattern: \"yyyy\",\n        hourTimePattern: \"H\",\n        minuteTimePattern: \"H:mm\",\n        secondTimePattern: \"H:mm:ss\",\n        millisecondTimePattern: \"H:mm:ss:SSS\"\n      },\n      'et': {\n        datePattern: \"d. MMMM yyyy\",\n        yearPattern: \"yyyy\",\n        hourTimePattern: \"H\",\n        minuteTimePattern: \"H:mm\",\n        secondTimePattern: \"H:mm:ss\",\n        millisecondTimePattern: \"H:mm:ss:SSS\"\n      },\n      'fi': {\n        datePattern: \"d. MMMM yyyy\",\n        yearPattern: \"yyyy\",\n        hourTimePattern: \"t\",\n        minuteTimePattern: \"t:mm a\",\n        secondTimePattern: \"t:mm:ss\",\n        millisecondTimePattern: \"h:mm:ss:SSS\"\n      },\n      'fr': {\n        datePattern: \"d MMMM yyyy\",\n        yearPattern: \"yyyy\",\n        hourTimePattern: \"HH\",\n        minuteTimePattern: \"HH:mm\",\n        secondTimePattern: \"HH:mm:ss\",\n        millisecondTimePattern: \"HH:mm:ss:SSS\"\n      },\n      'he': {\n        datePattern: \"d, MMMM ,yyyy\",\n        yearPattern: \"yyyy\",\n        hourTimePattern: \"h a\",\n        minuteTimePattern: \"h:mm a\",\n        secondTimePattern: \"h:mm:ss a\",\n        millisecondTimePattern: \"h:mm:ss:SSS a\"\n      },\n      'it': {\n        datePattern: \"d MMMM yyyy\",\n        yearPattern: \"yyyy\",\n        hourTimePattern: \"H\",\n        minuteTimePattern: \"H.mm\",\n        secondTimePattern: \"H.mm.ss\",\n        millisecondTimePattern: \"H.mm.ss.SSS\"\n      },\n      'ja': {\n        datePattern: \"yyyy'年'M'月'd'日'\",\n        yearPattern: \"yyyy'年'\",\n        hourTimePattern: \"h a\",\n        minuteTimePattern: \"h:mm a\",\n        secondTimePattern: \"h:mm:ss a\",\n        millisecondTimePattern: \"h:mm:ss:SSS a\"\n      },\n      'ko': {\n        datePattern: \"yyyy년 M월 d일\",\n        yearPattern: \"yyyy년\",\n        hourTimePattern: \"a h시\",\n        minuteTimePattern: \"a h:mm\",\n        secondTimePattern: \"a h:mm:ss\",\n        millisecondTimePattern: \"a h:mm:ss:SSS\"\n      },\n      'lt': {\n        datePattern: \"yyyy MMMM dd\",\n        yearPattern: \"yyyy\",\n        hourTimePattern: \"H a\",\n        minuteTimePattern: \"HH:mm\",\n        secondTimePattern: \"HH:mm:ss\",\n        millisecondTimePattern: \"HH:mm:ss:SSS\"\n      },\n      'lv': {\n        datePattern: \"dd.MM.yyyy\",\n        yearPattern: \"yyyy\",\n        hourTimePattern: \"H a\",\n        minuteTimePattern: \"HH:mm\",\n        secondTimePattern: \"HH:mm:ss\",\n        millisecondTimePattern: \"HH:mm:ss:SSS\"\n      },\n      'nb': {\n        datePattern: \"d. MMMM yyyy\",\n        yearPattern: \"yyyy\",\n        hourTimePattern: \"H\",\n        minuteTimePattern: \"H.mm\",\n        secondTimePattern: \"H.mm.ss\",\n        millisecondTimePattern: \"H.mm.ss.SSS\"\n      },\n      'nl': {\n        datePattern: \"d. MMMM yyyy\",\n        yearPattern: \"yyyy\",\n        hourTimePattern: \"H\",\n        minuteTimePattern: \"H:mm\",\n        secondTimePattern: \"H:mm:ss\",\n        millisecondTimePattern: \"H:mm:ss:SSS\"\n      },\n      'pl': {\n        datePattern: \"dd-mm-yyyy\",\n        yearPattern: \"yyyy\",\n        hourTimePattern: \"hh\",\n        minuteTimePattern: \"hh:mm\",\n        secondTimePattern: \"hh:mm:ss\",\n        millisecondTimePattern: \"hh:mm:ss:SSS\"\n      },\n      'pt-br': {\n        datePattern: \"d\\' de \\'MMMM\\' de \\'yyyy\",\n        yearPattern: \"yyyy\",\n        hourTimePattern: \"H\",\n        minuteTimePattern: \"h:mm a\",\n        secondTimePattern: \"H:mm:ss\",\n        millisecondTimePattern: \"H:mm:ss:SSS\"\n      },\n      'pt-pt': {\n        datePattern: \"d\\' de \\'MMMM\\' de \\'yyyy\",\n        yearPattern: \"yyyy\",\n        hourTimePattern: \"H\",\n        minuteTimePattern: \"H:mm\",\n        secondTimePattern: \"H:mm:ss\",\n        millisecondTimePattern: \"H:mm:ss:SSS\"\n      },\n      'ro': {\n        datePattern: \"d. MMMM yyyy\",\n        yearPattern: \"yyyy\",\n        hourTimePattern: \"H\",\n        minuteTimePattern: \"H:mm\",\n        secondTimePattern: \"H:mm:ss\",\n        millisecondTimePattern: \"H:mm:ss:SSS\"\n      },\n      'ru': {\n        datePattern: \"MMMM d, yyyy\",\n        yearPattern: \"yyyy\",\n        hourTimePattern: \"H\",\n        minuteTimePattern: \"h:mm\",\n        secondTimePattern: \"h:mm:ss\",\n        millisecondTimePattern: \"h:mm:ss:SSS\"\n      },\n      'sv': {\n        datePattern: \"MMMM d, yyyy\",\n        yearPattern: \"yyyy\",\n        hourTimePattern: \"h a\",\n        minuteTimePattern: \"h:mm a\",\n        secondTimePattern: \"h:mm:ss a\",\n        millisecondTimePattern: \"h:mm:ss:SSS a\"\n      },\n      'th': {\n        datePattern: \"d MMMM,yyyy\",\n        yearPattern: \"yyyy\",\n        hourTimePattern: \"H a\",\n        minuteTimePattern: \"h:mm a\",\n        secondTimePattern: \"h:mm:ss a\",\n        millisecondTimePattern: \"h:mm:ss:SSS a\"\n      },\n      'tr': {\n        datePattern: \"d MMMM yyyy\",\n        yearPattern: \"yyyy\",\n        hourTimePattern: \"h a\",\n        minuteTimePattern: \"h:mm a\",\n        secondTimePattern: \"h:mm:ss a\",\n        millisecondTimePattern: \"h:mm:ss:SSS a\"\n      },\n      'vi': {\n        datePattern: \"d MMMM, yyyy\",\n        yearPattern: \"yyyy\",\n        hourTimePattern: \"h a\",\n        minuteTimePattern: \"h:mm a\",\n        secondTimePattern: \"h:mm:ss a\",\n        millisecondTimePattern: \"h:mm:ss:SSS a\"\n      },\n      'zh-cn': {\n        datePattern: \"yyyy'年'M'月'd'日'\",\n        yearPattern: \"yyyy'年'\",\n        hourTimePattern: \"H\",\n        minuteTimePattern: \"H:mm\",\n        secondTimePattern: \"H:mm:ss\",\n        millisecondTimePattern: \"H:mm:ss:SSS\"\n      },\n      'zh-hk': {\n        datePattern: \"年月日\",\n        yearPattern: \"yyyy\",\n        hourTimePattern: \"h a\",\n        minuteTimePattern: \"h:mm a\",\n        secondTimePattern: \"h:mm:ss a\",\n        millisecondTimePattern: \"h:mm:ss:SSS a\"\n      },\n      'zh-tw': {\n        datePattern: \"年月日\",\n        yearPattern: \"yyyy\",\n        hourTimePattern: \"h a\",\n        minuteTimePattern: \"h:mm a\",\n        secondTimePattern: \"h:mm:ss a\",\n        millisecondTimePattern: \"h:mm:ss:SSS a\"\n      },\n      'en': {\n        datePattern: \"MMMM d, yyyy\",\n        yearPattern: \"yyyy\",\n        hourTimePattern: \"h a\",\n        minuteTimePattern: \"h:mm a\",\n        secondTimePattern: \"h:mm:ss a\",\n        millisecondTimePattern: \"h:mm:ss:SSS a\"\n      }\n    };\n\n    return clazz;\n  });"]}