{"version":3,"sources":["../../../../widgets/SmokeSlider/a11y/SpeedMenu.js"],"names":["define","lang","on","query","array","html","keys","a11yclick","mo","a11y_init","setAttr","speedLabelNode","nls","speed","a11y_setAriaLabel","dom","str","a11y_focusOnSelectedItem","speedMenu","item","parentElement","parentNode","focus","a11y_initEvents","speedList","a11y_firstNode","a11y_lastNode","length","own","hitch","evt","_onSpeedLabelClick","keyCode","ESCAPE","stopPropagation","preventDefault","_closeSpeedMenu","forEach","speedItem","i","previousOne","UP_ARROW","nextOne","DOWN_ARROW","TAB","ENTER","SPACE","emit","cancelable","bubbles"],"mappings":"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","file":"SpeedMenu.js","sourcesContent":["///////////////////////////////////////////////////////////////////////////\n// Copyright Â© Esri. All Rights Reserved.\n//\n// Licensed under the Apache License Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//    http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n///////////////////////////////////////////////////////////////////////////\n\ndefine([\n  'dojo/_base/lang',\n  'dojo/on',\n  \"dojo/query\",\n  //\"dojo/aspect\",\n  //'dojo/Deferred',\n  'dojo/_base/array',\n  'dojo/_base/html',\n  //'../utils',\n  //'jimu/utils',\n  'dojo/keys',\n  \"dijit/a11yclick\"\n],\n  function (lang, on, query,/* aspect,Deferred,*/ array, html, /*utils, jimuUtils,*/ keys, a11yclick) {\n    var mo = {};\n\n    mo.a11y_init = function () {\n      html.setAttr(this.speedLabelNode, \"role\", \"button\");\n      html.setAttr(this.speedLabelNode, \"aria-label\", this.nls.speed);\n    };\n\n    mo.a11y_setAriaLabel = function (dom, str){\n      html.setAttr(dom, \"aria-label\", str);\n    };\n\n    mo.a11y_focusOnSelectedItem = function () {\n      var dom = query(\".check:not(.hide)\", this.speedMenu)[0];\n      var item;\n      if(dom && (dom.parentElement || dom.parentNode)){\n        item = dom.parentElement || dom.parentNode;\n      }\n      if (item && item.focus) {\n        item.focus();\n      }\n    };\n\n    mo.a11y_initEvents = function () {\n      var speedList = query('[tabindex $=\\\"0\\\"]', this.speedMenu);\n      if (speedList) {\n        this.a11y_firstNode = speedList[0];\n        this.a11y_lastNode = speedList[speedList.length - 1];\n      }\n\n      //btn\n      this.own(on(this.speedLabelNode, a11yclick, lang.hitch(this, function (evt) {\n        this._onSpeedLabelClick(evt);\n      })));\n\n      //esc\n      this.own(on(this.speedMenu, 'keydown', lang.hitch(this, function (evt) {\n        if (evt.keyCode === keys.ESCAPE) {\n          evt.stopPropagation();\n          evt.preventDefault();\n          this._closeSpeedMenu();\n          this.speedLabelNode.focus();\n        }\n      })));\n\n      //list\n      if (speedList && speedList.length) {\n        this.a11y_firstNode = speedList[0];//1st one\n        this.a11y_lastNode = speedList[length - 1];//last one\n\n        array.forEach(speedList, lang.hitch(this, function (speedItem, i) {\n          var previousOne;\n          if (i === 0) {\n            previousOne = speedList[speedList.length - 1];\n          } else {\n            previousOne = speedList[i - 1];\n          }\n          this.own(on(speedItem, 'keydown', lang.hitch(this, function (evt) {\n            evt.stopPropagation();\n            evt.preventDefault();\n            if (evt.keyCode === keys.UP_ARROW) {\n              if (previousOne && previousOne.focus) {\n                //console.log(\"111 previousOne\" + nextOne.dataset.speed);\n                previousOne.focus();//up key\n              }\n            }\n          })));\n\n          var nextOne;\n          if (i === speedList.length - 1) {\n            nextOne = speedList[0];\n          } else {\n            nextOne = speedList[i + 1];\n          }\n          this.own(on(speedItem, 'keydown', lang.hitch(this, function (evt) {\n            evt.stopPropagation();\n            evt.preventDefault();\n            if (evt.keyCode === keys.DOWN_ARROW || evt.keyCode === keys.TAB) {\n              if (nextOne && nextOne.focus) {\n                //console.log(\"111 nextOne\" + nextOne.dataset.speed);\n                nextOne.focus();//down key\n              }\n            }\n          })));\n\n          this.own(on(speedItem, 'keydown', lang.hitch(this, function (evt) {\n            evt.stopPropagation();\n            evt.preventDefault();\n            if (evt.keyCode === keys.ENTER || evt.keyCode === keys.SPACE) {\n              //console.log(\"111 enter\" + speedItem.dataset.speed)\n              on.emit(speedItem, 'click', { cancelable: false, bubbles: true });//enter\n              //setTimeout(function () {\n              this.speedLabelNode.focus();\n              //}, 0);\n            }\n            //esc\n            if (evt.keyCode === keys.ESCAPE) {\n              this._closeSpeedMenu();\n              this.speedLabelNode.focus();\n            }\n          })));\n        }));\n      }\n    };\n\n    return mo;\n  });"]}