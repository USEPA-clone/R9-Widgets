{"version":3,"sources":["../../../../widgets/SmokeSlider/setting/TimeConfig.js"],"names":["define","declare","lang","html","BaseWidgetSetting","_WidgetsInTemplateMixin","on","template","utils","TimeCalendar","TimeExtent","CheckBox","Select","clazz","templateString","_KEEP_VALUE_FLAG","postCreate","startTimeCalendar","mode","nls","map","config","parent","endTimeCalendar","own","hitch","evt","_updateInterval","type","intervalNumber","_setKeepValueFlag","intervalUnits","options","intervalUnitOptions","displayAllTheData","label","displayAllData","checked","startup","inherited","arguments","setConfig","keepValueFlag","startTime","timeConfig","endTime","interval","set","number","units","refTime","Date","getCalendarTime","getConfig","findDefaultInterval","setValue","updateConfigByLyaers","evtType","_cleanErrorTips","intermediateChanges","isValid","_getKeepValueFlag","isValidDate","numberSpinner","hadError","hasClass","timeConfigContainer","valueOf","addClass","removeClass","testConfig","getValue","getLayersTimeExtent","te","flag","fullTimeExtent","timePerStop","getTime","year","Math","round","month","week","day","hour","minute","second"],"mappings":"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","file":"TimeConfig.js","sourcesContent":["///////////////////////////////////////////////////////////////////////////\n// Copyright Â© Esri. All Rights Reserved.\n//\n// Licensed under the Apache License Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//    http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n///////////////////////////////////////////////////////////////////////////\n\ndefine(['dojo/_base/declare',\n  'dojo/_base/lang',\n  'dojo/_base/html',\n  \"jimu/BaseWidgetSetting\",\n  \"dijit/_WidgetsInTemplateMixin\",\n  'dojo/on',\n  \"dojo/text!./TimeConfig.html\",\n  \"../utils\",\n  './TimeCalendar',\n  'esri/TimeExtent',\n  \"jimu/dijit/CheckBox\",\n  \"dijit/form/Select\",\n  \"dijit/form/ValidationTextBox\"\n],\n  function (declare, lang, html,\n    BaseWidgetSetting, _WidgetsInTemplateMixin,\n    on, template, utils, TimeCalendar, TimeExtent,\n    CheckBox, Select) {\n    var clazz = declare([BaseWidgetSetting, _WidgetsInTemplateMixin], {\n      templateString: template,\n      /*\n        configFromat = {\n          startTime:{\n            timeConfig: TimeCalendar.config\n          },\n          endTime:{\n            timeConfig: TimeCalendar.config\n          },\n          interval:{\n            number: null //number\n            units:\"\"//esriTimeInfo.X\n          }\n          displayAllData: false//t / f\n        }\n      */\n      _KEEP_VALUE_FLAG: false,//set true, afer user change any setting\n\n      postCreate: function () {\n        this.startTimeCalendar = new TimeCalendar({\n          mode: \"min\",\n          nls: this.nls,\n          map: this.map,\n          config: this.config,\n          parent: this\n        }, this.startTimeCalendar);\n\n        this.endTimeCalendar = new TimeCalendar({\n          mode: \"max\",\n          nls: this.nls,\n          map: this.map,\n          config: this.config,\n          parent: this\n        }, this.endTimeCalendar);\n\n        this.own(on(this.startTimeCalendar, \"haveloaded,change\", lang.hitch(this, function (evt) {\n          this._updateInterval(evt.type);\n        })));\n\n        this.own(on(this.endTimeCalendar, \"haveloaded,change\", lang.hitch(this, function (evt) {\n          this._updateInterval(evt.type);\n        })));\n\n        //interval\n        this.own(on(this.intervalNumber, \"change\", lang.hitch(this, function () {\n          this._setKeepValueFlag(true);\n        })));\n        this.intervalUnits = new Select({\n          options: utils.intervalUnitOptions,\n          \"class\": \"calendar-inputs\"\n        }, this.intervalUnits);\n        this.own(on(this.intervalUnits, \"change\", lang.hitch(this, function () {\n          this._setKeepValueFlag(true);\n        })));\n\n        this.displayAllTheData = new CheckBox({\n          label: this.nls.displayAllData,\n          checked: false\n        }, this.displayAllTheData);\n        this.displayAllTheData.startup();\n\n        //init\n        this.startTimeCalendar.startup();\n        this.endTimeCalendar.startup();\n\n        this.inherited(arguments);\n      },\n\n      setConfig: function (config) {\n        if (\"undefined\" !== typeof config.keepValueFlag) {\n          this._setKeepValueFlag(config.keepValueFlag);\n        }\n\n        if (\"undefined\" !== typeof config.startTime) {\n          this.startTimeCalendar.setConfig(config.startTime.timeConfig);\n        }\n        if (\"undefined\" !== typeof config.endTime) {\n          this.endTimeCalendar.setConfig(config.endTime.timeConfig);\n        }\n\n        if (\"undefined\" !== typeof config.interval) {\n          this.intervalNumber.set(\"value\", config.interval.number, false);\n          this.intervalUnits.set(\"value\", config.interval.units, false);\n        } else {\n          var refTime = new Date();\n          var startTime = utils.getCalendarTime(this.startTimeCalendar.getConfig(), refTime);\n          var endTime = utils.getCalendarTime(this.endTimeCalendar.getConfig(), refTime);\n\n          this.findDefaultInterval(new TimeExtent(startTime, endTime));\n        }\n        if (\"undefined\" !== typeof config.displayAllData) {\n          this.displayAllTheData.setValue(!!config.displayAllData, false);\n        } else {\n          this.displayAllTheData.setValue(false, false);\n        }\n      },\n      updateConfigByLyaers: function (config) {\n        if (\"undefined\" !== typeof config.startTime) {\n          this.startTimeCalendar.setConfig(config.startTime.timeConfig);\n        }\n        if (\"undefined\" !== typeof config.endTime) {\n          this.endTimeCalendar.setConfig(config.endTime.timeConfig);\n        }\n\n        this._updateInterval();\n      },\n      _updateInterval: function (evtType) {\n        this._cleanErrorTips();\n\n        if (evtType === \"haveloaded\") {\n          this.intervalNumber.intermediateChanges = false;//skip bug dijit/form/NumberSpinner.set(\"value\", XXX, false);\n        }\n\n        if (false === this.isValid()) {\n          return;\n        }\n        if (this._getKeepValueFlag()) {\n          return;\n        }\n\n        var refTime = new Date();\n        var startTime = utils.getCalendarTime(this.startTimeCalendar.getConfig(), refTime);\n        var endTime = utils.getCalendarTime(this.endTimeCalendar.getConfig(), refTime);\n\n        var interval = this.findDefaultInterval(new TimeExtent(new Date(startTime), new Date(endTime)));\n        this.intervalNumber.set(\"value\", interval.interval, false);\n        this.intervalUnits.set(\"value\", interval.units, false);\n      },\n\n      isValid: function () {\n        var refTime = new Date();\n        var startTime = utils.getCalendarTime(this.startTimeCalendar.getConfig(), refTime);\n        var endTime = utils.getCalendarTime(this.endTimeCalendar.getConfig(), refTime);\n\n        //1 inValid time\n        if (!utils.isValidDate(startTime)) {\n          this.startTimeCalendar.numberSpinner.set(\"state\", \"Error\");\n          return false;\n        }\n        if (!utils.isValidDate(endTime)) {\n          this.endTimeCalendar.numberSpinner.set(\"state\", \"Error\");\n          return false;\n        }\n\n        //2 inValid value\n        if (!this.startTimeCalendar.isValid() || !this.endTimeCalendar.isValid() || !this.intervalNumber.isValid()) {\n          return false;\n        }\n\n        //3 startTime should be <= endTime\n        var hadError = html.hasClass(this.timeConfigContainer, \"error\");\n        if (startTime.valueOf() > endTime.valueOf()) {\n          if (!hadError) {//avoid to popup too many errors\n            html.addClass(this.timeConfigContainer, \"error\");\n          }\n          return false;\n        } else {\n          html.removeClass(this.timeConfigContainer, \"error\");\n          return true;\n        }\n      },\n      _cleanErrorTips: function () {\n        html.removeClass(this.timeConfigContainer, \"error\");\n      },\n\n      getConfig: function () {\n        var testConfig = {\n          keepValueFlag: this._getKeepValueFlag(),\n          startTime: {\n            timeConfig: this.startTimeCalendar.getConfig()\n          },\n          endTime: {\n            timeConfig: this.endTimeCalendar.getConfig()\n          },\n          interval: {\n            number: this.intervalNumber.getValue(),//number\n            units: this.intervalUnits.getValue()//esriTimeInfo.X\n          },\n          displayAllData: this.displayAllTheData.getValue()//t / f\n        };\n        return testConfig;\n      },\n\n      getLayersTimeExtent: function () {\n        var te = this.parent.getLayersTimeExtent();\n        return te;\n      },\n\n      //read only falg\n      _setKeepValueFlag: function (flag) {\n        this._KEEP_VALUE_FLAG = flag;\n      },\n      _getKeepValueFlag: function () {\n        return !!this._KEEP_VALUE_FLAG;\n      },\n\n      //TODO\n      findDefaultInterval: function (fullTimeExtent) {\n        var interval;\n        var units;\n        var timePerStop = (fullTimeExtent.endTime.getTime() - fullTimeExtent.startTime.getTime()) / 10;\n        //var century = 1000 * 60 * 60 * 24 * 30 * 12 * 100;\n        //if (timePerStop > century) {\n        //  interval = Math.round(timePerStop / century);\n        //  units = \"esriTimeUnitsCenturies\";\n        //} else {\n        //  var decade = 1000 * 60 * 60 * 24 * 30 * 12 * 10;\n        //  if (timePerStop > decade) {\n        //    interval = Math.round(timePerStop / decade);\n        //    units = \"esriTimeUnitsDecades\";\n        //  } else {\n        var year = 1000 * 60 * 60 * 24 * 30 * 12;\n        if (timePerStop > year) {\n          interval = Math.round(timePerStop / year);\n          units = \"esriTimeUnitsYears\";\n        } else {\n          var month = 1000 * 60 * 60 * 24 * 30;\n          if (timePerStop > month) {\n            interval = Math.round(timePerStop / month);\n            units = \"esriTimeUnitsMonths\";\n          } else {\n            var week = 1000 * 60 * 60 * 24 * 7;\n            if (timePerStop > week) {\n              interval = Math.round(timePerStop / week);\n              units = \"esriTimeUnitsWeeks\";\n            } else {\n              var day = 1000 * 60 * 60 * 24;\n              if (timePerStop > day) {\n                interval = Math.round(timePerStop / day);\n                units = \"esriTimeUnitsDays\";\n              } else {\n                var hour = 1000 * 60 * 60;\n                if (timePerStop > hour) {\n                  interval = Math.round(timePerStop / hour);\n                  units = \"esriTimeUnitsHours\";\n                } else {\n                  var minute = 1000 * 60;\n                  if (timePerStop > minute) {\n                    interval = Math.round(timePerStop / minute);\n                    units = \"esriTimeUnitsMinutes\";\n                  } else {\n                    var second = 1000;\n                    if (timePerStop > second) {\n                      interval = Math.round(timePerStop / second);\n                      units = \"esriTimeUnitsSeconds\";\n                    } else {\n                      interval = Math.round(timePerStop);\n                      units = \"esriTimeUnitsMilliseconds\";\n                    }\n                  }\n                }\n              }\n            }\n          }\n        }\n        //  }\n        //}\n\n        return {\n          interval: interval,\n          units: units\n        };\n      }\n    });\n    return clazz;\n  });"]}