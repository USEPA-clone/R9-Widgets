{"version":3,"sources":["../../../../widgets/SmokeSlider/setting/LayersConfig.js"],"names":["define","Evented","declare","lang","esriLang","html","array","_WidgetBase","_TemplatedMixin","_WidgetsInTemplateMixin","on","template","LayerInfos","utils","jimuUtils","CheckBox","clazz","templateString","layersCheckboxes","startup","getInstance","map","itemInfo","then","hitch","layerInfosObj","_layerInfosObj","infos","getLayerInfoArray","forEach","info","isTimeLayer","isDefined","layerObject","timeInfo","timeExtent","addARow","emit","getFullTimeExtent","maxHeight","rowHeight","length","setStyle","layersContainer","inherited","arguments","_creatTableRow","container","layerName","row","create","layerNameDom","sanitizeHTML","timeInfoDom","layerInfo","checkBox","label","id","_layerId","checked","own","startTimeLabel","localizeDate","startTime","endTimeLabel","endTime","timeStr","nls","timeTo","setAttr","push","timeExtents","getValue","fts","noRound","setConfig","config","layer","isTimeEnable","setValue","getConfig","layersConfig","isValid"],"mappings":"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","file":"LayersConfig.js","sourcesContent":["///////////////////////////////////////////////////////////////////////////\n// Copyright Â© Esri. All Rights Reserved.\n//\n// Licensed under the Apache License Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//    http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n///////////////////////////////////////////////////////////////////////////\n\ndefine(['dojo/Evented',\n  'dojo/_base/declare',\n  'dojo/_base/lang',\n  \"esri/lang\",\n  'dojo/_base/html',\n  'dojo/_base/array',\n  'dijit/_WidgetBase',\n  'dijit/_TemplatedMixin',\n  \"dijit/_WidgetsInTemplateMixin\",\n  'dojo/on',\n  \"dojo/text!./LayersConfig.html\",\n  'jimu/LayerInfos/LayerInfos',\n  //'moment/moment',\n  \"../utils\",\n  'jimu/utils',\n  \"jimu/dijit/CheckBox\"\n],\n  function (Evented, declare, lang, esriLang, html, array,\n    _WidgetBase, _TemplatedMixin, _WidgetsInTemplateMixin,\n    on, template, LayerInfos,/* moment,*/ utils, jimuUtils,\n    CheckBox) {\n    var clazz = declare([_WidgetBase, _TemplatedMixin, _WidgetsInTemplateMixin, Evented], {\n      templateString: template,\n      layersCheckboxes: [],\n      /*\n      var layers = [{\n          id:\n          isTimeEnable:\n        },{\n          id:\n          isTimeEnable\n      }]\n      */\n      startup: function () {\n        //var timeLayers = [];\n        this.layersCheckboxes = [];\n        LayerInfos.getInstance(this.map, this.map.itemInfo).then(lang.hitch(this, function (layerInfosObj) {\n          //table head\n          //this._creatTableRow(this.layersContainer, this.nls.layerTableCol1, this.nls.layerTableCol2);\n\n          this._layerInfosObj = layerInfosObj;\n          var infos = this._layerInfosObj.getLayerInfoArray();\n\n          array.forEach(infos, lang.hitch(this, function (info) {\n            //show all time layers, even disabled in webmap\n            var isTimeLayer = (esriLang.isDefined(info.layerObject.timeInfo) &&\n              esriLang.isDefined(info.layerObject.timeInfo.timeExtent));\n            if (isTimeLayer) {\n              this.addARow(info);\n            }\n          }));\n\n          this.emit('initTimeExtent', this.getFullTimeExtent());\n          this.emit('initedLaysers', this.getFullTimeExtent());\n\n          //scorller\n          //var nowHeight = html.getContentBox(this.layersContainer);\n          var maxHeight = 170;\n          var rowHeight = 50;\n          //html.setStyle(this.layersContainer, \"max-height\", maxHeight + \"px\");\n          if ((infos.length * rowHeight) >= maxHeight) {\n            html.setStyle(this.layersContainer, \"overflow-y\", \"auto\");\n          } else {\n            html.setStyle(this.layersContainer, \"overflow-y\", \"hidden\");\n          }\n        }));\n\n        this.inherited(arguments);\n      },\n\n      // _emitChangeEvent:function(){\n      //   this.emit('initTimeExtent', this.getFullTimeExtent());\n      // },\n      _creatTableRow: function (container, layerName, timeInfo) {\n        var row = html.create('div', {\n          \"class\": \"row\"\n        }, container);\n        var layerNameDom = html.create('div', {\n          \"class\": \"layer-name\",\n          \"innerHTML\": jimuUtils.sanitizeHTML(layerName || \"\")\n        }, row);\n        var timeInfoDom = html.create('div', {\n          \"class\": \"time-info\",\n          \"innerHTML\": jimuUtils.sanitizeHTML(timeInfo || \"\")\n        }, row);\n\n        return {\n          layerNameDom: layerNameDom,\n          timeInfoDom: timeInfoDom\n        };\n      },\n      addARow: function (layerInfo) {\n        var row = this._creatTableRow(this.layersContainer);\n\n        var checkBox = new CheckBox({\n          label: layerInfo.id,\n          _layerId: layerInfo.id,\n          checked: true//default selected\n        }, row.layerNameDom);\n        this.own(on(checkBox, 'change', lang.hitch(this, function () {\n          this.emit('change', this.getFullTimeExtent());\n        })));\n\n        if (layerInfo.layerObject.timeInfo && esriLang.isDefined(layerInfo.layerObject.timeInfo.timeExtent)) {\n          var startTimeLabel = jimuUtils.localizeDate(layerInfo.layerObject.timeInfo.timeExtent.startTime);\n          var endTimeLabel = jimuUtils.localizeDate(layerInfo.layerObject.timeInfo.timeExtent.endTime);\n\n          var timeStr = startTimeLabel + \"   \" + this.nls.timeTo + \"   \" + endTimeLabel;\n          html.setAttr(row.timeInfoDom, \"innerHTML\", jimuUtils.sanitizeHTML(timeStr));\n          checkBox.timeExtent = layerInfo.layerObject.timeInfo.timeExtent;\n        }\n\n        //this.own(on(this.selectedBtn, 'click', lang.hitch(this, this.onSelected)));\n        this.layersCheckboxes.push(checkBox);\n\n        return row;\n      },\n\n      getFullTimeExtent: function () {\n        if (0 === this.layersCheckboxes.length) {\n          return null;//no time layers\n        }\n\n        var timeExtents = [];\n        array.forEach(this.layersCheckboxes, lang.hitch(this, function (checkBox) {\n          if (checkBox.timeExtent && true === checkBox.getValue()) {\n            timeExtents.push(checkBox.timeExtent);\n          }\n        }));\n\n        var fts;\n        if (timeExtents.length > 0) {\n          var noRound = true;\n          fts = utils.getFullTimeExtent(timeExtents, noRound);\n        } else {\n          return null;\n        }\n\n        return {\n          timeExtent: fts\n        };\n      },\n\n      setConfig: function (config) {\n        if (!config) {\n          return;\n        }\n\n        array.forEach(this.layersCheckboxes, lang.hitch(this, function (checkBox) {\n          array.forEach(config, lang.hitch(this, function (layer) {\n            if (checkBox._layerId === layer.id) {\n              if (true === layer.isTimeEnable) {\n                checkBox.setValue(true);\n              } else {\n                checkBox.setValue(false);\n              }\n            }\n          }));\n        }));\n      },\n      getConfig: function () {\n        var layersConfig = [];\n\n        array.forEach(this.layersCheckboxes, lang.hitch(this, function (checkBox) {\n          layersConfig.push({\n            id: checkBox._layerId,\n            isTimeEnable: checkBox.checked\n          });\n        }));\n\n        return layersConfig;\n      },\n      isValid: function () {\n        return true;\n      }\n    });\n    return clazz;\n  });"]}